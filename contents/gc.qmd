# Guiding Center {#sec-GC}

Here are the essentials points in the derivation of the _guiding center equations of motion (EOM)_. For a complete discussion refer to @vandervoort1960relativistic.

The basic equation governing the motion of a charged particle with mass m and charge e is given by
$$
\frac{\mathrm{d}\mathbf{u}}{\mathrm{d}t} = \frac{e}{mc}\left( c\mathbf{E} + \mathbf{v}\times\mathbf{B} \right)
$$
where $\mathbf{u}=\gamma\mathbf{v}$ represents the particle’s four-velocity, $\mathbf{v}$ is the particle velocity, c is the speed of light while $\mathbf{E}$ and $\mathbf{B}$ are the electric and magnetic field vectors, respectively.

In GCA, the orbital motion of the particle is detached from its instantaneous gyration center. This relaxes any constraints related to particle gyration, allowing systematic larger time steps to be taken and thus a considerable saving in computational time. The guiding center (GC) equations are obtained in the limit of slow-varying fields. This restricts its validity to situations in which the Larmor radius remains negligible with respect to the overall electromagnetic field scale and in which the cyclotron frequency is large enough so that adiabatic invariance holds. In this respect, the GCA is most suitable for particles with large charge-to-mass ratios such as electrons.

## Relativity

### Velocity

The path of an object in three-dimensional space (in an inertial frame) may be expressed in terms of three spatial coordinate functions $x^i(t)$ of time $t$, where $i$ is an index which takes values 1, 2, 3.

The three coordinates form the 3d position vector, written as a column vector
$$
\mathbf{x}(t)=
\begin{bmatrix}
x^{1}(t)\\
x^{2}(t)\\
x^{3}(t)
\end{bmatrix}
$$

The components of the velocity $\mathbf{u}$ (tangent to the curve) at any point on the world line are
$$
\mathbf{u}=
\begin{bmatrix}
u^{1}\\
u^{2}\\
u^{3}
\end{bmatrix}
=\frac{\mathrm{d}\mathbf{x}}{\mathrm{d}t}=
\begin{bmatrix}
\frac{\mathrm{d}x^{1}}{\mathrm{d}t} \\
\frac{\mathrm{d}x^{2}}{\mathrm{d}t} \\
\frac{\mathrm{d}x^{3}}{\mathrm{d}t} 
\end{bmatrix}
$$ {#eq-velocity}

Each component is simply written $u^i = \mathrm{d}x^i / \mathrm{d}t$.

### Theory of relativity

In Einstein's theory of relativity, the path of an object moving relative to a particular frame of reference is defined by four coordinate functions $x_\mu(\tau)$, where $\mu$ is a spacetime index which takes the value 0 for the timelike component, and 1, 2, 3 for the spacelike coordinates. The zeroth component is defined as the time coordinate multiplied by c,
$$
x^0 = ct
$$ {#eq-time-coordinate}

Each function depends on one parameter τ called its _proper time_. As a column vector,
$$
\mathbf{x}=
\begin{bmatrix}
x^{0}(\tau)\\
x^{1}(\tau)\\
x^{2}(\tau)\\
x^{3}(\tau)
\end{bmatrix}
$$

**Time dilation**

From time dilation, the differentials in coordinate time $t$ and proper time $\tau$ are related by
$$
\mathrm{d}t = \gamma(u)\mathrm{d}\tau
$$ {#eq-time-dilation}
where the Lorentz factor,
$$
\gamma(u) = \frac{1}{\sqrt{1 - \frac{u^2}{c^2}}}
$$ {#eq-lorentz-factor}
is a function of the Euclidean norm $u$ of the 3d velocity vector $\mathbf{u}$:
$$
u=\left\|\ {\mathbf{u}}\ \right\|=\sqrt{\left(u^{1}\right)^{2}+\left(u^{2}\right)^{2}+\left(u^{3}\right)^{2}}
$$

#### Four-velocity

A _four-velocity_ is a _four-vector_ in four-dimensional spacetime that represents the relativistic counterpart of velocity, which is a three-dimensional vector in space.

Physical events correspond to mathematical points in time and space, the set of all of them together forming a mathematical model of physical four-dimensional spacetime. The history of an object traces a curve in spacetime, called its world line. If the object has mass, so that its speed is necessarily less than the speed of light, the world line may be parametrized by the proper time of the object. The four-velocity is the rate of change of four-position with respect to the proper time along the curve. The velocity, in contrast, is the rate of change of the position in (three-dimensional) space of the object, as seen by an observer, with respect to the observer's time.

The four-velocity is the tangent four-vector of a timelike world line. The four-velocity $\mathbf{U}$ at any point of world line 
$\mathbf{X}(\tau)$ is defined as
$$
\mathbf{U} = \frac{\mathrm{d}\mathbf{X}}{\mathrm{d}\tau}
$$ {#eq-four-velocity}
where $\mathbf{X}$ is the four-position and $\tau$ is the proper time.[^existence]

[^existence]: The four-velocity defined here using the proper time of an object does not exist for world lines for massless objects such as photons travelling at the speed of light.

The relationship between the time $t$ and the coordinate time $x^0$ is defined by
$$
x^0 = ct
$$ {#eq-four-velocity-0}

Taking the derivative of this with respect to the proper time $\tau$, we find the $U_\mu$ velocity component for $\mu = 0$:
$$
U^{0}=\frac{\mathrm{d}x^{0}}{\mathrm{d}\tau}={\frac{\mathrm{d}(ct)}{\mathrm{d}\tau}}=c\frac{\mathrm{d}t}{\mathrm{d}\tau}=c\gamma(u)
$$ {#eq-four-velocity-1}
and for the other 3 components to proper time we get the $U_\mu$ velocity component for $\mu = 1, 2, 3$:
$$
U^{i}=\frac{\mathrm{d}x^{i}}{\mathrm{d}\tau} = \frac{\mathrm{d}x^{i}}{\mathrm{d}t}{\frac{\mathrm{d}t}{\mathrm{d}\tau}} = \frac {\mathrm{d}x^{i}}{\mathrm{d}t} \gamma(u) = \gamma(u)u^{i}
$$ {#eq-four-velocity-3}
where we have used the chain rule from @eq-velocity and @eq-time-dilation.

Thus, we find for the four-velocity $\mathbf{U}$:
$$
\mathbf{U}= \gamma
\begin{bmatrix}
c \\
\mathbf{u}
\end{bmatrix}
$$

Written in standard four-vector notation this is
$$
\mathbf{U}=\gamma \left(c,{\mathbf{u}}\right) = \left(\gamma c,\gamma {\mathbf{u}}\right)
$$ {#eq-four-velocity-vector}
where $\gamma c$ is the temporal component and $\gamma \mathbf{u}$ is the spatial component. Unlike most other four-vectors, the four-velocity has only 3 independent components $u_{x},u_{y},u_{z}$ instead of 4. The $\gamma$ factor is a function of the three-dimensional velocity $\mathbf{u}$.

Using the differential of the four-position in the rest frame, the magnitude of the four-velocity can be obtained by the Minkowski metric with signature (−, +, +, +):
$$
\left\|\mathbf{U} \right\|^{2}=\eta_{\mu\nu}U^{\mu}U^{\nu}=\eta_{\mu\nu}{\frac{\mathrm{d}X^{\mu}}{\mathrm{d}\tau}}{\frac{\mathrm{d}X^{\nu}}{\mathrm{d}\tau}}=-c^{2}
$$ {#eq-four-velocity-mag}
which is always a fixed constant.

## Lorentz Equation in Tensor Form

In order to derive the Guiding Center Approximation (GCA), we would use the tensor notations in relativity.
The equation of motion for a charged particle in an EM field are written in a tensorial form as
$$
\frac{\mathrm{d}x_\mu}{\mathrm{d}\tau^2} = F_{\mu\nu} \frac{\mathrm{d}x_\nu}{\mathrm{d}\tau}
$$ {#eq-charged-particle-motion-general}
where $x_\mu$ is the particle four-coordinate, $F_{\mu\nu}$ is the EM tensor and $\tau$ is the particle proper time.

The EM tensor is
$$
F_{\mu\nu} = \frac{e}{mc}
\begin{pmatrix}
0 & B_z & -B_y & E_x \\
-B_z & 0 & B_x & E_y \\
B_y & -B_x & 0 & E_z \\
E_x & E_y & E_z & 0
\end{pmatrix}
$$ {#eq-em-tensor}

## Fundamental Assumptions

The GC formalism holds under two fundamental assumptions, namely:

1. The gyration radius must remain small compared to the scale length upon which the electromagnetic field changes significantly.
2. The particle undergoes many gyrations before the electromagnetic field changes appreciably (slowl-varying fields  pproximation). If we let $\rho$ be the particle gyroradius (apart from a factor √2), $x_\mu$ the particle position, $X_\mu$ the GC position, $\tau$ the proper time and $F_{\mu\nu}$ the EM field tensor, the two conditions stated above can be mathematically expressed as
$$
\rho \left| \frac{\partial F_{\mu\nu}}{\partial x_\alpha} \right| \ll \left| F_{\mu\nu} \right|
$$ {#eq-gca-condition1}
and
$$
\frac{1}{\omega} \left| \frac{\partial F_{\mu\nu}}{\partial x_\alpha} \right| \left| \frac{\mathbf{d}X_\beta}{\mathrm{d}\tau} \right| \ll \left| F_{\mu\nu} \right|
$$ {#eq-gca-condition2}
where $\omega$ is the gyrofrequency. When the previous conditions hold, we can separate the particle trajectory into a gyration and a motion of the guiding center.

## Derivations of GC Equation

The general solution of @eq-charged-particle-motion-general is a linear combination of the two fundamental solutions related to the four EM tensor eigenvalues $q=\pm i\omega$ and $q=\pm\lambda$, where
$$
\begin{aligned}
\omega &= \frac{e}{mc}\sqrt{\frac{1}{2}(B^2 - E^2) + \frac{1}{2}\sqrt{(B^2 - E^2)^2 + 4(\mathbf{E}\cdot\mathbf{B})^2}} \\
\lambda &= \frac{e}{mc}\sqrt{-\frac{1}{2}(B^2 - E^2) + \frac{1}{2}\sqrt{(B^2 - E^2)^2 + 4(\mathbf{E}\cdot\mathbf{B})^2}}
\end{aligned}
$$ {#eq-EM-eigenvalues}

$\omega$ is a generalized relativistic form of the Larmor frequency $\omega_\xi = eB/(mc)$ in the case when $E\neq 0$ (which can be verified by solving in the limit $E\to 0$). The general solution $x_\mu$ of @eq-charged-particle-motion-general is
$$
x_\mu = \xi_\mu\rho \cos(\omega\tau) - \eta_\mu \rho \sin(\omega\tau) + \alpha_\mu \nu \cosh(\lambda\tau) + \beta_\mu \nu \sinh(\lambda\tau)
$$ {#eq-charged-particle-motion-general-sol}

Note that the first two terms are related to a periodic motion, that is the gyration around magnetic field lines with gyroradius $\rho$. Here $\rho, \nu$ are constants defined by the initial conditions and $\xi_\mu,\eta_\mu,\alpha_\mu$ and $\beta_\mu$ are four-versors normalized in the manner
$$
\xi_\mu^2 = \eta_\mu^2 = 1,\quad \text{and}\quad \alpha_\mu^2 = -\beta_\mu^2 = 1
$$ {#eq-charged-particle-motion-general-sol-normalization}

Solutions for $\rho = 0$ and $\nu = 0$ must be valid separately, so by replacing $x_\mu$ for these two particular cases inside @eq-charged-particle-motion-general we can see that $\xi_\mu,\eta_\mu,\alpha_\mu$ and $\beta_\mu$ form an orthogonal set of the Minkowsky space. The orthogonality relations between this set of four-vectors in particular states that the periodic motion (gyration) in the $(\xi_mu,\eta_\mu)$-plane is perpendicular to the acceleration motion in the $(\alpha_\mu, \beta_\mu)$-plane, and will be useful later. At this point, another useful relation is retrieved from the squared velocity invariance
$$
\frac{\mathrm{d}x_\mu}{\mathrm{d}\tau}\frac{\mathrm{d}x_\mu}{\mathrm{d}\tau} = -c^2,\quad\text{which leads to}\quad \omega^2\rho^2 - \lambda^2\nu^2 = -c^2
$$ {#eq-sqr-v-invariance}

Since we are only interested in cases in which gyration appears, the only singular eigenvalue case we must consider is the one with $\lambda=0, \omega\neq 0$, corresponding to $\mathbf{E}\cdot\mathbf{B}=0$ and $|\mathbf{E}|\to 0$. The associated solution is
$$
x_\mu = \xi_\mu\rho \cos(\omega\tau) - \eta_\mu \rho \sin(\omega\tau) + U_\mu \tau
$$ {#eq-associated-sol}

Here the gyration motion with Larmor frequency $\omega_\xi = \omega$ is clearly shown, along with a uniform motion (drift) with velocity $U_\mu = (\gamma c, \mathbf{U})$ in the plane perpendicular to the $(\mathbf{E}, \mathbf{B})$-plane.[^verification]
In this particular case, the squared velocity invariance @eq-sqr-v-invariance becomes
$$
\omega^2\rho^2 + U_\mu^2 = -c^2,\quad\text{or}\quad U_\mu^2 = -c^2 - \omega^2\rho^2 < -c^2
$$ {#eq-sqr-v-invariance1}

[^verification]: For verification simply substitute $x_\mu$ and $U_\mu$ in the left and right-end side of @eq-charged-particle-motion-general, respectively, to find that $F_{\mu\nu} U_\nu = 0$, and rewrite the indexes of such equation explicitly.

@eq-sqr-v-invariance1 is of crucial importance in the GCA formalism, because the drift motion $U_\mu$ is the mean motion separated from the gyration and corresponds to the GC motion itself, meaning that what we just found is a relation between the energy and momentum of a particle guiding center. It is very similar to the well-known formula of the squared four-velocity ${U_\mu^\prime}^2=-c^2$, the only difference being an additional term $\omega^2\rho^2$. This suggests interpreting the motion of the GC as the one of a particle located in the center of gyration, performing no gyration and possessing a squared four velocity as stated in @eq-sqr-v-invariance1, in agreement with part of the particle kinetic energy being stored in the gyration motion through the term $\omega^2\rho^2$. By separating the spatial and temporal parts of $U_\mu$ and rearranging some terms inside @eq-sqr-v-invariance1, we can get a relation for the GC Lorentz factor
$$
\gamma_\text{GC} = \sqrt{1+\frac{|\mathbf{U}|^2}{c^2} + \frac{\omega^2\rho^2}{c^2}} = \sqrt{1+\frac{\gamma^2|\mathbf{v}|^2}{c^2} + \frac{\omega^2\rho^2}{c^2}}
$$ {#eq-gc-gamma}

Although we only considered a limit case, the same equation can be proven to be generally valid in the GCA formalism.

We now want to isolate the gyration motion in a general case. This is done by separating the motion as follows:
$$
x_\mu = \xi_\mu x + \eta_\mu y + x_\mu^\prime + X_\mu
$$ {#eq-gc-separation-of-motion}
where $x_\mu$ is the space-time position of the particle and $X_\mu$ is the position of the guiding center. We associate two variables $x$ and $y$ to describe the periodic motion in the $(\xi, \eta)$-plane, and the term $x_\mu^\prime$ will account for the periodic motions which do not lie in the same plane. To more easily describe the gyration, we also choose a new pair of variables
$$
\zeta = \frac{1}{\sqrt{2}}\left( x+ iy \right)\quad\text{and}\quad \zeta^\ast = \frac{1}{\sqrt{2}}\left( x - iy \right)
$$ {#eq-gc-new-vars}
so that $\xi_\mu x + \eta_\mu y = \delta_\mu\zeta + \sigma_\mu\zeta^\ast$. The new variables will allow us to choose $\zeta_\mu$ and $\delta_\mu$ in a more convenient way and let some factor $e^{i\phi}$ account for the initial conditions of the problem. We rewrite the particle coordinate using @eq-gc-new-vars
$$
x_\mu = \delta_\mu\zeta + \sigma_\mu\zeta^\ast + x_\mu^\prime + X_\mu
$$ {#eq-eq-gc-new-vars2}

The next step is substituting this expression into @eq-charged-particle-motion-general and expand the second derivative, which leads to a lengthy expression containing eight unkowns: $\zeta,\zeta^\ast$, two components of $x_\mu$ (the condition with the $(\sigma, \delta)$-plane sets the other two), and four components of $X_\mu$.

The conditions for the GCA expressed in @eq-gca-condition2 implicitly contain a parameter of smallness $\epsilon =|u/\omega L|\ll 1$, where u is the typical particle four-velocity and L the scale length upon which the change in the EM fields $F_{\mu\nu}$ is comparable to $F_{\mu\nu}$ (slowly-varying fields approximation). This allows us to approximate $F_{\mu\nu}(x_\mu)$ (particle coordinate) by using a Taylor expansion about $X_\mu$ (the GC coordinate)
$$
\begin{aligned}
F_{\mu\nu}(x_\mu) =& F_{\mu\nu}(X_\mu) \\
&+ \frac{\partial F_{\mu\nu}}{\partial x_\xi}(\delta_\xi \zeta + \sigma_\xi \zeta^\ast) \\
&+ \frac{1}{2} \frac{\partial^2 F_{\mu\nu}}{\partial x_\xi\partial x_\pi}\left[ \delta_\xi\delta_\pi \zeta^2 + \sigma_\xi\sigma_\pi {\zeta^\ast}^2 + (\sigma_\xi \delta_\pi + \sigma_\pi \delta_\xi)|\zeta|^2 \right] \\
&+ \frac{\partial F_{\mu\nu}}{\partial x_\xi} x_\xi^\prime + ...
\end{aligned}
$$

We should now substitute $F_{\mu\nu}(x_\mu)$ inside @eq-charged-particle-motion-general using the new coordinates in order to get a quite long equation containing all quantities evaluated at the GC position $X_\mu$ up to 2nd−order, and group all 2nd−order terms on the right-end side as $G_\mu$
$$
\begin{aligned}
&\delta_\mu\frac{\mathrm{d}^2\zeta}{\mathrm{d}\tau^2} + \sigma_\mu\frac{\mathrm{d}^2\zeta^\ast}{\mathrm{d}\tau^2}+\left( i\omega\delta_\mu + 2\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} \right)\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} \\
&+\left( -i\omega\sigma_\mu + 2\frac{\mathrm{d}\sigma_\mu}{\mathrm{d}\tau} \right) \frac{\mathrm{d}\zeta^\ast}{\mathrm{d}\tau} + \frac{\mathrm{d}^2\delta_\mu}{\mathrm{d}\tau^2}\zeta + \frac{\mathrm{d}^2\sigma_\mu}{\mathrm{d}\tau^2}\zeta^\ast \\
&- \frac{\partial F_{\mu\nu}}{\partial x_\xi}\left( \delta_\xi \zeta + \sigma_\xi \zeta^\ast \right)\frac{\mathrm{d}X_\nu}{\mathrm{d}\tau} - F_{\mu\nu}\left( \frac{\mathrm{d}\delta_\nu}{\mathrm{d}\tau}\zeta + \frac{\mathrm{d}\sigma_\nu}{\mathrm{d}\tau}\zeta^\ast \right) \\
&- \frac{\partial F_{\mu\nu}}{\partial x_\xi}\left( \delta_\xi \zeta + \sigma_\xi \zeta^\ast \right) \left( \delta_\nu\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} + \sigma_\nu\frac{\mathrm{d}\zeta^\ast}{\mathrm{d}\tau} \right) \\
&+ \left( \frac{\mathrm{d}^2 X_\nu}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}X_\mu}{\mathrm{d}\tau} \right) + \left( \frac{d^2 x_\mu^\prime}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}x_\nu^\prime}{\mathrm{d}\tau} \right) = G_\mu
\end{aligned}
$$ {#eq-gc-expansion}

An expression for $\zeta$ is needed to further proceed, but since the derivation is quite long we will not explicitly derive it here. The basic idea is to use the orthogonality equations for the new four-vectors $\sigma_\mu$ and $\delta_\mu$ and the antisymmetry property of the EM tensor inside Maxwell's equations written in tensorial form, and then assume that a solution for $X_\mu$ has already been found. Considered that $x_\mu$ is a 1st−order term in the GCA, by ignoring 2nd−order quantities and writing terms independent from $\zeta$ as a numerical value $P$, then @eq-gc-expansion becomes
$$
\frac{\mathrm{d}^2\zeta}{\mathrm{d}\tau^2} + i\Omega\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} + \frac{i}{2}\frac{\mathrm{d}\Omega}{\mathrm{d}\tau}\zeta + \Omega a \zeta + P = 0
$$ {#eq-gc-expansion2}
where $\Omega a \zeta$ contains all the linear terms in $\zeta$. Consequently, the corresponding solution $\zeta$, by analogy to the _Wentzel–Kramers–Brillouin (WKB)_ approximation in quantum mechanics, is
$$
\zeta = \rho_0 \sqrt{\frac{\omega_0}{\Omega}}\exp\left[ -i\left( \Phi + \int_{\tau_0}^\tau \sigma_1 \mathrm{d}\tau \right) \right]
$$ {#eq-gc-wkb}
to the 0th-order, being
$$
\Omega = \omega - 2i\sigma_\mu \frac{\mathrm{d}\delta_\mu}{\mathrm{d}\tau},\quad \Phi = \int_{\tau_0}^{\tau}\Omega\mathrm{d}\tau - \phi,\quad\text{and}\quad \sigma = a - \frac{a^2}{\Omega}
$$ {#eq-gc-wkb2}
The subscripts 0, 1 indicate the associated order of approximation for quantities defined above.

Since now we know the expression for $\zeta$, we can write the 1st−order EOM for $X_\mu$. For this purpose, we require that in the left-end side of @eq-gc-expansion the terms containing the 1st− and 2nd−order derivatives of $X_\mu$ are balanced by the remaining nonoscillatory terms, that is
$$
\frac{\mathrm{d}^2 X_\mu}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}X_\nu}{\mathrm{d}\tau} = \frac{\partial F_{\mu\nu}}{\partial x_\xi}\left( \delta_\xi \sigma_\nu \frac{\mathrm{d}\zeta^\ast}{\mathrm{d}\tau} + \delta_\nu \sigma_\xi \frac{\mathrm{d}\zeta}{\mathrm{d}\tau} \right)
$$ {#eq-gc-balance}

Having found the solution @eq-gc-wkb and making use once again of the orthogonality relations for $\delta_\mu$ and $\sigma_\mu$ and the tensorial Maxwell's equations, we can write the equation of motion for the GC
$$
\frac{\mathrm{d}^2 X_\mu}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}X_\nu}{\mathrm{d}\tau} + \rho_0^2 \omega_0\frac{\partial\omega}{\partial x_\mu} = 0
$$ {#eq-gc-eom}
where $\omega$ (@eq-EM-eigenvalues) is the generalized Larmor frequency, $\rho_0^2 \omega_0 = \mu_0 = mc\gamma^2 v_\perp^2 / 2eB$ is the 0th-order approximation (apart from a constant factor) to the particle magnetic moment $\mu$ and $\omega_0 = eB/(mc)$ represents the lowest-order approximation to the Larmor frequency in the case $E\ll B$.

More precisely, the magnetic moment should be regarded as constant only in the reference frame moving at $\mathbf{v}_E$, because in that particular case $\mathbf{E} = 0$. Indeed, a formal analysis (@northrop1960stability) shows that the corresponding constant of motion in a general reference frame is actually an asymptotic series expansion in a smallness parameter $\epsilon=u/(\omega_0 L)$ in the form $\mu = (e/c)\left[ \mu_0 + \epsilon \mu_1 + \epsilon^2 \mu_2 + ... \right]$ so that $\mu_0$ is not constant and can still vary in compliance with the adiabatic theory. Nevertheless, extensive numerical testing confirms that the
errors due to assuming $\mathrm{d}\mu_0 / \mathrm{d}t \approx 0$ are at most of the same order of those introduced by the GC formalism, as a consequence of the slowly varying field condition which prevents sensible changes in the magnetic moment. Hence, we safely assume that $\mu \approx (e/c)\mu_0$ is invariant.

## First Order Solution for the GCA Equations of Motion

Although deceitful simple, the GC equation of motion @eq-gc-eom is more conveniently cast in a form in which the GC velocity appears explicitly, under the nearly-crossed (EM) fields condition
$$
\frac{\mathbf{E}_\parallel \cdot\mathbf{B}}{B^2 - E_\perp^2} \ll 1
$$ {#eq-nearly-cross-em}
where the subscripts $\parallel$ and $\perp$ indicate the parallel and perpendicular components of the electric field with
respect to the magnetic field unit vector $\hat{b}$. It can be proven that @eq-nearly-cross-em allows the EM tensor field $F_{\mu\nu}$ to be split into a contribution $F_{\mu\ni}^{(0)}$ constructed solely from $\mathbf{E}_\perp$ and $\mathbf{B}$, plus a correction term $F_{\mu\nu}^{(1)}$ depending on $\mathbf{E}_\parallel$. A formal analysis leads to the conclusion that the GC four-velocity $U_\mu \equiv \mathrm{d}X_\mu/\mathrm{d}\tau$ can be decomposed into a 0th-order contribution $\mathrm{U}^{(0)}$ (which contains the drift velocity $\mathbf{v}_E = c\mathbf{E}_\perp \times\mathbf{B}/B^2$ as well as the velocity component parallel to the magnetic field line $v_\parallel \hat{b}$) plus 1st-order correction $\mathbf{U}^{(1)}$, leading to
$$
U_\mu = (\gamma c, \mathbf{U}) \simeq (\gamma c, \gamma v_\parallel \hat{b} + \gamma \mathbf{v}_E + \mathbf{U}^{(1)})
$$ {#eq-four-velocity-decomposition}
where $\gamma$ is the particle Lorentz factor $\gamma = (1- v^2/c^2)^{-1/2}$. An equation for $\mathbf{U}^{(1)}$ can be derived from @eq-gc-eom using a recursive approach as shown below, while from the spatial component one obtains an equation (to the same order) for the parallel component of the GC four-velocity $\gamma v_\parallel$. These yield the (1st-order) GCA system of ordinary differential equations (ODEs)
$$
\begin{aligned}
\frac{\mathrm{d}\mathbf{X}}{\mathrm{d}t} &= \mathbf{v}_E + v_\parallel \hat{b} + \frac{\gamma_E^2}{B}\hat{b}\times\left[ \frac{mc\gamma}{e}\left( v_\parallel\mathcal{L}(\hat{b}) + \mathcal{L}(\mathbf{v}_E) \right) + \mathcal{M}\left( \frac{B}{\gamma_E} \right) + \frac{v_\parallel E_\parallel}{c}\mathbf{v}_E \right] \\
\frac{\mathrm{d}(\gamma v_\parallel)}{\mathrm{d}t} &= \frac{e}{m}E_\parallel - \gamma\hat{b}\cdot\mathcal{L}(\mathbf{v}_E) - \frac{\mu}{\gamma m}\hat{b}\cdot\nabla\left(\frac{B}{\gamma_E}\right)
\end{aligned}
$$ {#eq-gc-eom-1st-sol}
where $\mathrm{d}\mathbf{X}/\mathrm{d}t = \mathbf{U}^{(1)}/\gamma$ represents the velocity of the guiding center, $e/m$ is the particle charge-to-mass ratio and $\mu_0 = c\mu/e$. The operators $\mathcal{L}$ and $\mathcal{M}$ are defined as
$$
\begin{aligned}
\mathcal{L}(x) &= \frac{\partial\mathbf{x}}{\partial t} + v_\parallel(\hat{b}\cdot\nabla)\mathbf{x} + (\mathbf{v}_E\cdot\nabla)\mathbf{x} \\
\mathcal{M}(x) &= \frac{\mu}{e\gamma}\left[ \frac{\mathbf{v}_E}{c}\frac{\partial x}{\partial t} + c\nabla x \right]
\end{aligned}
$$ {#eq-gc-eom-1st-operator}
where $\gamma_E = (1 - E_\perp^2/B^2)^{-1/2}$ is the Lorentz factor associated to the drift velocity $\mathbf{v}_E$.

In the GCA @eq-gc-eom-1st-sol information about motion perpendicular to the magnetic field is lost and the only component of the particle velocity that is actually evolved in time is $u_\parallel$, because the magnetic moment $\mu_0\approx c\mu/e$ is now considered a constant of motion. Each term on the right hand side of @eq-gc-eom-1st-sol corresponds to a specific drift motion. Indeed, the first term represents the $\mathbf{E}\times\mathbf{B}$ perpendicular drift, while the second one accounts for particle motion in the direction parallel to magnetic field. The first two terms in square bracket, $\mathcal{L}(\hat{b})$ and $\mathcal{L}(\mathbf{v}_E)$, describe the field curvature and polarization drifts[^L-lagrangian], respectively. The next term is the $\nabla-B$ drift, while the last one represents a relativistic drift in the direction given by $\hat{b}\times\mathbf{v}_E$.

[^L-lagrangian]: Notice that the $\mathcal{L}()$ operator is the Lagrangian derivative $\mathrm{d}/\mathrm{d}t$.

@eq-gc-eom-1st-sol lose their validity when either $B\to 0$ (magnetic null) or $E_\perp \ge B$, i.e. when the nearly-crossed EM fields condition, @eq-nearly-cross-em, is violated. While the first condition can easily occur inside a current sheet, the second may occur in a non-ideal MHD regime only. Violation of either condition breaks down the GCA and can lead to severe numerical errors.

### Recursive solution

An explicit solution for @eq-gc-eom can be found under @eq-nearly-cross-em, which introduces a new parameter of smallness $\lambda / \omega \ll 1$.

### Energy conservation

The time component of @eq-gc-eom leads to an evolutionary ODE for the particle energy as a function of time, namely
$$
\frac{\mathrm{d}\gamma c^2}{\mathrm{d}t} = \frac{e}{m}\frac{\mathrm{d}\mathbf{X}}{\mathrm{d}t}\cdot\mathbf{E} + \frac{\mu}{m}\frac{\partial}{\partial t}\left( \frac{B}{\gamma_E} \right)
$$ {#eq-gc-eom-time}

In the time-independent case, @eq-gc-eom-time clearly shows that, when the GC velocity is perpendicular to the electric field, no acceleration occurs and the particle energy is conserved. For numerical purposes, however, @eq-gc-eom-time is not solved for retrieving the Lorentz $\gamma$-factor, since large values of the right hand side could easily violate the condition $\gamma\ge 1$ at the truncation level of the scheme, unless small time steps are taken. In practice, to an 1st-order approximation, the particle velocity can be decomposed into a parallel component $v_\parallel$, a drift component $v_E$ and a gyration component $v_\perp$. This leads to the normalization condition
$$
\gamma^2( c^2 - v_\parallel^2 - v_\perp^2 - v_E^2) = c^2 
$$ {#eq-gc-eom-normalization-1st}

From the definition of the magnetic moment and the Larmor frequency $\mu_0 = mc\gamma^2 v_\perp^2/(2eB) = \gamma^2 v_\perp^2/(2\omega_0)$, we compute the particle Lorentz factor as
$$
\gamma = \sqrt{\frac{c^2 + \gamma^2 v_\parallel^2 + 2\mu_0 \omega_0}{c^2 - v_E^2}}
$$ {#eq-gc-eom-lorentz}

@eq-gc-eom-lorentz replaces @eq-gc-eom-time in common numerical solvers to get the Lorentz factor.

### Numerical implementation

The GCA @eq-gc-eom-1st-sol contains a set of 4 ODEs with unknowns $(\mathbf{X}, u_\parallel)$. The terms which require evaluation at grids are

* $\mathbf{B}$
* $c\mathbf{E}$
* $(\hat{b}\cdot\nabla)\hat{b}$
* $(\hat{b}\cdot\nabla)\mathbf{v}_E$
* $(\mathbf{v}_E\cdot\nabla)\mathbf{v}_E$
* $(\mathbf{v}_E\cdot\nabla)\hat{b}$
* $\nabla(B/\gamma_E)$

#### Nonrelativistic case

In the nonrelativistic case, $\gamma = 1$ so we don't need to solve @eq-gc-eom-lorentz. @eq-gc-eom-1st-sol can be simplified into
$$
\begin{aligned}
\frac{\mathrm{d}\mathbf{X}}{\mathrm{d}t} &=  \\
\frac{\mathrm{d}(v_\parallel)}{\mathrm{d}t} &= 
\end{aligned}
$$ {#eq-gc-eom-1st-sol-nonrelativistic}
