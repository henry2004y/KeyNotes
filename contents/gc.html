<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Key Notes in Plasma Physics - 23&nbsp; Guiding Center Approximations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../contents/cr.html" rel="next">
<link href="../contents/aurora.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../contents/gc.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Guiding Center Approximations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Key Notes in Plasma Physics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/henry2004y/KeyNotes/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Math</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/single.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Single-Particle Motions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/fluid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Plasmas as Fluid</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/diffres.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Diffusion and Resisvity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/wave.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Waves</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/emhd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">EMHD</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/kinetic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Kinetic Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/stability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Stability</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/kmhd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Kinetic MHD</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/gyrokinetics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Gyrokinetics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/flr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Field Line Resonance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Nonlinear Effects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/turbulence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Turbulence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/geometry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Geometry</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/solarwind.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Solar Wind</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/shock.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Shock</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/magnetosphere.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Magnetosphere</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/ionosphere.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ionosphere</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/radiationbelt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Radiation Belt</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/aurora.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Aurora</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/gc.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Guiding Center Approximations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/cr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Cosmic Ray</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Boundary Conditions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/pic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Particle-in-Cell</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/hybrid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Hybrid Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/raytracing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Ray Tracing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/inductance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Inductance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/capacitance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Capacitance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#relativity" id="toc-relativity" class="nav-link active" data-scroll-target="#relativity"><span class="header-section-number">23.1</span> Relativity</a>
  <ul class="collapse">
  <li><a href="#velocity" id="toc-velocity" class="nav-link" data-scroll-target="#velocity"><span class="header-section-number">23.1.1</span> Velocity</a></li>
  <li><a href="#theory-of-relativity" id="toc-theory-of-relativity" class="nav-link" data-scroll-target="#theory-of-relativity"><span class="header-section-number">23.1.2</span> Theory of relativity</a></li>
  </ul></li>
  <li><a href="#lorentz-equation-in-tensor-form" id="toc-lorentz-equation-in-tensor-form" class="nav-link" data-scroll-target="#lorentz-equation-in-tensor-form"><span class="header-section-number">23.2</span> Lorentz Equation in Tensor Form</a></li>
  <li><a href="#fundamental-assumptions" id="toc-fundamental-assumptions" class="nav-link" data-scroll-target="#fundamental-assumptions"><span class="header-section-number">23.3</span> Fundamental Assumptions</a></li>
  <li><a href="#derivations-of-gc-equation" id="toc-derivations-of-gc-equation" class="nav-link" data-scroll-target="#derivations-of-gc-equation"><span class="header-section-number">23.4</span> Derivations of GC Equation</a></li>
  <li><a href="#first-order-solution-for-the-gca-equations-of-motion" id="toc-first-order-solution-for-the-gca-equations-of-motion" class="nav-link" data-scroll-target="#first-order-solution-for-the-gca-equations-of-motion"><span class="header-section-number">23.5</span> First Order Solution for the GCA Equations of Motion</a>
  <ul class="collapse">
  <li><a href="#recursive-solution" id="toc-recursive-solution" class="nav-link" data-scroll-target="#recursive-solution"><span class="header-section-number">23.5.1</span> Recursive solution</a></li>
  <li><a href="#energy-conservation" id="toc-energy-conservation" class="nav-link" data-scroll-target="#energy-conservation"><span class="header-section-number">23.5.2</span> Energy conservation</a></li>
  <li><a href="#numerical-implementation" id="toc-numerical-implementation" class="nav-link" data-scroll-target="#numerical-implementation"><span class="header-section-number">23.5.3</span> Numerical implementation</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/henry2004y/KeyNotes/edit/master/contents/gc.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-GCA" class="quarto-section-identifier"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Guiding Center Approximations</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Here are the essentials points in the derivation of the <em>guiding center equations of motion (EOM)</em>. For a complete discussion refer to <span class="citation" data-cites="vandervoort1960relativistic">Vandervoort (<a href="#ref-vandervoort1960relativistic" role="doc-biblioref">1960</a>)</span>.</p>
<p>The basic equation governing the motion of a charged particle with mass m and charge e is given by <span class="math display">\[
\frac{\mathrm{d}\mathbf{u}}{\mathrm{d}t} = \frac{e}{mc}\left( c\mathbf{E} + \mathbf{v}\times\mathbf{B} \right)
\]</span> where <span class="math inline">\(\mathbf{u}=\gamma\mathbf{v}\)</span> represents the particle’s four-velocity, <span class="math inline">\(\mathbf{v}\)</span> is the particle velocity, c is the speed of light while <span class="math inline">\(\mathbf{E}\)</span> and <span class="math inline">\(\mathbf{B}\)</span> are the electric and magnetic field vectors, respectively.</p>
<p>In GCA, the orbital motion of the particle is detached from its instantaneous gyration center. This relaxes any constraints related to particle gyration, allowing systematic larger time steps to be taken and thus a considerable saving in computational time. The guiding center (GC) equations are obtained in the limit of slow-varying fields. This restricts its validity to situations in which the Larmor radius remains negligible with respect to the overall electromagnetic field scale and in which the cyclotron frequency is large enough so that adiabatic invariance holds. In this respect, the GCA is most suitable for particles with large charge-to-mass ratios such as electrons.</p>
<section id="relativity" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="relativity"><span class="header-section-number">23.1</span> Relativity</h2>
<section id="velocity" class="level3" data-number="23.1.1">
<h3 data-number="23.1.1" class="anchored" data-anchor-id="velocity"><span class="header-section-number">23.1.1</span> Velocity</h3>
<p>The path of an object in three-dimensional space (in an inertial frame) may be expressed in terms of three spatial coordinate functions <span class="math inline">\(x^i(t)\)</span> of time <span class="math inline">\(t\)</span>, where <span class="math inline">\(i\)</span> is an index which takes values 1, 2, 3.</p>
<p>The three coordinates form the 3d position vector, written as a column vector <span class="math display">\[
\mathbf{x}(t)=
\begin{bmatrix}
x^{1}(t)\\
x^{2}(t)\\
x^{3}(t)
\end{bmatrix}
\]</span></p>
<p>The components of the velocity <span class="math inline">\(\mathbf{u}\)</span> (tangent to the curve) at any point on the world line are <span id="eq-velocity"><span class="math display">\[
\mathbf{u}=
\begin{bmatrix}
u^{1}\\
u^{2}\\
u^{3}
\end{bmatrix}
=\frac{\mathrm{d}\mathbf{x}}{\mathrm{d}t}=
\begin{bmatrix}
\frac{\mathrm{d}x^{1}}{\mathrm{d}t} \\
\frac{\mathrm{d}x^{2}}{\mathrm{d}t} \\
\frac{\mathrm{d}x^{3}}{\mathrm{d}t}
\end{bmatrix}
\tag{23.1}\]</span></span></p>
<p>Each component is simply written <span class="math inline">\(u^i = \mathrm{d}x^i / \mathrm{d}t\)</span>.</p>
</section>
<section id="theory-of-relativity" class="level3" data-number="23.1.2">
<h3 data-number="23.1.2" class="anchored" data-anchor-id="theory-of-relativity"><span class="header-section-number">23.1.2</span> Theory of relativity</h3>
<p>In Einstein’s theory of relativity, the path of an object moving relative to a particular frame of reference is defined by four coordinate functions <span class="math inline">\(x_\mu(\tau)\)</span>, where <span class="math inline">\(\mu\)</span> is a spacetime index which takes the value 0 for the timelike component, and 1, 2, 3 for the spacelike coordinates. The zeroth component is defined as the time coordinate multiplied by c, <span id="eq-time-coordinate"><span class="math display">\[
x^0 = ct
\tag{23.2}\]</span></span></p>
<p>Each function depends on one parameter τ called its <em>proper time</em>. As a column vector, <span class="math display">\[
\mathbf{x}=
\begin{bmatrix}
x^{0}(\tau)\\
x^{1}(\tau)\\
x^{2}(\tau)\\
x^{3}(\tau)
\end{bmatrix}
\]</span></p>
<p><strong>Time dilation</strong></p>
<p>From time dilation, the differentials in coordinate time <span class="math inline">\(t\)</span> and proper time <span class="math inline">\(\tau\)</span> are related by <span id="eq-time-dilation"><span class="math display">\[
\mathrm{d}t = \gamma(u)\mathrm{d}\tau
\tag{23.3}\]</span></span> where the Lorentz factor, <span id="eq-lorentz-factor"><span class="math display">\[
\gamma(u) = \frac{1}{\sqrt{1 - \frac{u^2}{c^2}}}
\tag{23.4}\]</span></span> is a function of the Euclidean norm <span class="math inline">\(u\)</span> of the 3d velocity vector <span class="math inline">\(\mathbf{u}\)</span>: <span class="math display">\[
u=\left\|\ {\mathbf{u}}\ \right\|=\sqrt{\left(u^{1}\right)^{2}+\left(u^{2}\right)^{2}+\left(u^{3}\right)^{2}}
\]</span></p>
<section id="four-velocity" class="level4" data-number="23.1.2.1">
<h4 data-number="23.1.2.1" class="anchored" data-anchor-id="four-velocity"><span class="header-section-number">23.1.2.1</span> Four-velocity</h4>
<p>A <em>four-velocity</em> is a <em>four-vector</em> in four-dimensional spacetime that represents the relativistic counterpart of velocity, which is a three-dimensional vector in space.</p>
<p>Physical events correspond to mathematical points in time and space, the set of all of them together forming a mathematical model of physical four-dimensional spacetime. The history of an object traces a curve in spacetime, called its world line. If the object has mass, so that its speed is necessarily less than the speed of light, the world line may be parametrized by the proper time of the object. The four-velocity is the rate of change of four-position with respect to the proper time along the curve. The velocity, in contrast, is the rate of change of the position in (three-dimensional) space of the object, as seen by an observer, with respect to the observer’s time.</p>
<p>The four-velocity is the tangent four-vector of a timelike world line. The four-velocity <span class="math inline">\(\mathbf{U}\)</span> at any point of world line <span class="math inline">\(\mathbf{X}(\tau)\)</span> is defined as <span id="eq-four-velocity"><span class="math display">\[
\mathbf{U} = \frac{\mathrm{d}\mathbf{X}}{\mathrm{d}\tau}
\tag{23.5}\]</span></span> where <span class="math inline">\(\mathbf{X}\)</span> is the four-position and <span class="math inline">\(\tau\)</span> is the proper time.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The relationship between the time <span class="math inline">\(t\)</span> and the coordinate time <span class="math inline">\(x^0\)</span> is defined by <span id="eq-four-velocity-0"><span class="math display">\[
x^0 = ct
\tag{23.6}\]</span></span></p>
<p>Taking the derivative of this with respect to the proper time <span class="math inline">\(\tau\)</span>, we find the <span class="math inline">\(U_\mu\)</span> velocity component for <span class="math inline">\(\mu = 0\)</span>: <span id="eq-four-velocity-1"><span class="math display">\[
U^{0}=\frac{\mathrm{d}x^{0}}{\mathrm{d}\tau}={\frac{\mathrm{d}(ct)}{\mathrm{d}\tau}}=c\frac{\mathrm{d}t}{\mathrm{d}\tau}=c\gamma(u)
\tag{23.7}\]</span></span> and for the other 3 components to proper time we get the <span class="math inline">\(U_\mu\)</span> velocity component for <span class="math inline">\(\mu = 1, 2, 3\)</span>: <span id="eq-four-velocity-3"><span class="math display">\[
U^{i}=\frac{\mathrm{d}x^{i}}{\mathrm{d}\tau} = \frac{\mathrm{d}x^{i}}{\mathrm{d}t}{\frac{\mathrm{d}t}{\mathrm{d}\tau}} = \frac {\mathrm{d}x^{i}}{\mathrm{d}t} \gamma(u) = \gamma(u)u^{i}
\tag{23.8}\]</span></span> where we have used the chain rule from <a href="#eq-velocity" class="quarto-xref">Equation&nbsp;<span>23.1</span></a> and <a href="#eq-time-dilation" class="quarto-xref">Equation&nbsp;<span>23.3</span></a>.</p>
<p>Thus, we find for the four-velocity <span class="math inline">\(\mathbf{U}\)</span>: <span class="math display">\[
\mathbf{U}= \gamma
\begin{bmatrix}
c \\
\mathbf{u}
\end{bmatrix}
\]</span></p>
<p>Written in standard four-vector notation this is <span id="eq-four-velocity-vector"><span class="math display">\[
\mathbf{U}=\gamma \left(c,{\mathbf{u}}\right) = \left(\gamma c,\gamma {\mathbf{u}}\right)
\tag{23.9}\]</span></span> where <span class="math inline">\(\gamma c\)</span> is the temporal component and <span class="math inline">\(\gamma \mathbf{u}\)</span> is the spatial component. Unlike most other four-vectors, the four-velocity has only 3 independent components <span class="math inline">\(u_{x},u_{y},u_{z}\)</span> instead of 4. The <span class="math inline">\(\gamma\)</span> factor is a function of the three-dimensional velocity <span class="math inline">\(\mathbf{u}\)</span>.</p>
<p>Using the differential of the four-position in the rest frame, the magnitude of the four-velocity can be obtained by the Minkowski metric with signature (−, +, +, +): <span id="eq-four-velocity-mag"><span class="math display">\[
\left\|\mathbf{U} \right\|^{2}=\eta_{\mu\nu}U^{\mu}U^{\nu}=\eta_{\mu\nu}{\frac{\mathrm{d}X^{\mu}}{\mathrm{d}\tau}}{\frac{\mathrm{d}X^{\nu}}{\mathrm{d}\tau}}=-c^{2}
\tag{23.10}\]</span></span> which is always a fixed constant.</p>
</section>
</section>
</section>
<section id="lorentz-equation-in-tensor-form" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="lorentz-equation-in-tensor-form"><span class="header-section-number">23.2</span> Lorentz Equation in Tensor Form</h2>
<p>In order to derive the Guiding Center Approximation (GCA), we would use the tensor notations in relativity. The equation of motion for a charged particle in an EM field are written in a tensorial form as <span id="eq-charged-particle-motion-general"><span class="math display">\[
\frac{\mathrm{d}x_\mu}{\mathrm{d}\tau^2} = F_{\mu\nu} \frac{\mathrm{d}x_\nu}{\mathrm{d}\tau}
\tag{23.11}\]</span></span> where <span class="math inline">\(x_\mu\)</span> is the particle four-coordinate, <span class="math inline">\(F_{\mu\nu}\)</span> is the EM tensor and <span class="math inline">\(\tau\)</span> is the particle proper time.</p>
<p>The EM tensor is <span id="eq-em-tensor"><span class="math display">\[
F_{\mu\nu} = \frac{e}{mc}
\begin{pmatrix}
0 &amp; B_z &amp; -B_y &amp; E_x \\
-B_z &amp; 0 &amp; B_x &amp; E_y \\
B_y &amp; -B_x &amp; 0 &amp; E_z \\
E_x &amp; E_y &amp; E_z &amp; 0
\end{pmatrix}
\tag{23.12}\]</span></span></p>
</section>
<section id="fundamental-assumptions" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="fundamental-assumptions"><span class="header-section-number">23.3</span> Fundamental Assumptions</h2>
<p>The GC formalism holds under two fundamental assumptions, namely:</p>
<ol type="1">
<li>The gyration radius must remain small compared to the scale length upon which the electromagnetic field changes significantly.</li>
<li>The particle undergoes many gyrations before the electromagnetic field changes appreciably (slowl-varying fields pproximation). If we let <span class="math inline">\(\rho\)</span> be the particle gyroradius (apart from a factor √2), <span class="math inline">\(x_\mu\)</span> the particle position, <span class="math inline">\(X_\mu\)</span> the GC position, <span class="math inline">\(\tau\)</span> the proper time and <span class="math inline">\(F_{\mu\nu}\)</span> the EM field tensor, the two conditions stated above can be mathematically expressed as <span id="eq-gca-condition1"><span class="math display">\[
\rho \left| \frac{\partial F_{\mu\nu}}{\partial x_\alpha} \right| \ll \left| F_{\mu\nu} \right|
\tag{23.13}\]</span></span> and <span id="eq-gca-condition2"><span class="math display">\[
\frac{1}{\omega} \left| \frac{\partial F_{\mu\nu}}{\partial x_\alpha} \right| \left| \frac{\mathbf{d}X_\beta}{\mathrm{d}\tau} \right| \ll \left| F_{\mu\nu} \right|
\tag{23.14}\]</span></span> where <span class="math inline">\(\omega\)</span> is the gyrofrequency. When the previous conditions hold, we can separate the particle trajectory into a gyration and a motion of the guiding center.</li>
</ol>
</section>
<section id="derivations-of-gc-equation" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="derivations-of-gc-equation"><span class="header-section-number">23.4</span> Derivations of GC Equation</h2>
<p>The general solution of <a href="#eq-charged-particle-motion-general" class="quarto-xref">Equation&nbsp;<span>23.11</span></a> is a linear combination of the two fundamental solutions related to the four EM tensor eigenvalues <span class="math inline">\(q=\pm i\omega\)</span> and <span class="math inline">\(q=\pm\lambda\)</span>, where <span id="eq-EM-eigenvalues"><span class="math display">\[
\begin{aligned}
\omega &amp;= \frac{e}{mc}\sqrt{\frac{1}{2}(B^2 - E^2) + \frac{1}{2}\sqrt{(B^2 - E^2)^2 + 4(\mathbf{E}\cdot\mathbf{B})^2}} \\
\lambda &amp;= \frac{e}{mc}\sqrt{-\frac{1}{2}(B^2 - E^2) + \frac{1}{2}\sqrt{(B^2 - E^2)^2 + 4(\mathbf{E}\cdot\mathbf{B})^2}}
\end{aligned}
\tag{23.15}\]</span></span></p>
<p><span class="math inline">\(\omega\)</span> is a generalized relativistic form of the Larmor frequency <span class="math inline">\(\omega_\xi = eB/(mc)\)</span> in the case when <span class="math inline">\(E\neq 0\)</span> (which can be verified by solving in the limit <span class="math inline">\(E\to 0\)</span>). The general solution <span class="math inline">\(x_\mu\)</span> of <a href="#eq-charged-particle-motion-general" class="quarto-xref">Equation&nbsp;<span>23.11</span></a> is <span id="eq-charged-particle-motion-general-sol"><span class="math display">\[
x_\mu = \xi_\mu\rho \cos(\omega\tau) - \eta_\mu \rho \sin(\omega\tau) + \alpha_\mu \nu \cosh(\lambda\tau) + \beta_\mu \nu \sinh(\lambda\tau)
\tag{23.16}\]</span></span></p>
<p>Note that the first two terms are related to a periodic motion, that is the gyration around magnetic field lines with gyroradius <span class="math inline">\(\rho\)</span>. Here <span class="math inline">\(\rho, \nu\)</span> are constants defined by the initial conditions and <span class="math inline">\(\xi_\mu,\eta_\mu,\alpha_\mu\)</span> and <span class="math inline">\(\beta_\mu\)</span> are four-versors normalized in the manner <span id="eq-charged-particle-motion-general-sol-normalization"><span class="math display">\[
\xi_\mu^2 = \eta_\mu^2 = 1,\quad \text{and}\quad \alpha_\mu^2 = -\beta_\mu^2 = 1
\tag{23.17}\]</span></span></p>
<p>Solutions for <span class="math inline">\(\rho = 0\)</span> and <span class="math inline">\(\nu = 0\)</span> must be valid separately, so by replacing <span class="math inline">\(x_\mu\)</span> for these two particular cases inside <a href="#eq-charged-particle-motion-general" class="quarto-xref">Equation&nbsp;<span>23.11</span></a> we can see that <span class="math inline">\(\xi_\mu,\eta_\mu,\alpha_\mu\)</span> and <span class="math inline">\(\beta_\mu\)</span> form an orthogonal set of the Minkowsky space. The orthogonality relations between this set of four-vectors in particular states that the periodic motion (gyration) in the <span class="math inline">\((\xi_mu,\eta_\mu)\)</span>-plane is perpendicular to the acceleration motion in the <span class="math inline">\((\alpha_\mu, \beta_\mu)\)</span>-plane, and will be useful later. At this point, another useful relation is retrieved from the squared velocity invariance <span id="eq-sqr-v-invariance"><span class="math display">\[
\frac{\mathrm{d}x_\mu}{\mathrm{d}\tau}\frac{\mathrm{d}x_\mu}{\mathrm{d}\tau} = -c^2,\quad\text{which leads to}\quad \omega^2\rho^2 - \lambda^2\nu^2 = -c^2
\tag{23.18}\]</span></span></p>
<p>Since we are only interested in cases in which gyration appears, the only singular eigenvalue case we must consider is the one with <span class="math inline">\(\lambda=0, \omega\neq 0\)</span>, corresponding to <span class="math inline">\(\mathbf{E}\cdot\mathbf{B}=0\)</span> and <span class="math inline">\(|\mathbf{E}|\to 0\)</span>. The associated solution is <span id="eq-associated-sol"><span class="math display">\[
x_\mu = \xi_\mu\rho \cos(\omega\tau) - \eta_\mu \rho \sin(\omega\tau) + U_\mu \tau
\tag{23.19}\]</span></span></p>
<p>Here the gyration motion with Larmor frequency <span class="math inline">\(\omega_\xi = \omega\)</span> is clearly shown, along with a uniform motion (drift) with velocity <span class="math inline">\(U_\mu = (\gamma c, \mathbf{U})\)</span> in the plane perpendicular to the <span class="math inline">\((\mathbf{E}, \mathbf{B})\)</span>-plane.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> In this particular case, the squared velocity invariance <a href="#eq-sqr-v-invariance" class="quarto-xref">Equation&nbsp;<span>23.18</span></a> becomes <span id="eq-sqr-v-invariance1"><span class="math display">\[
\omega^2\rho^2 + U_\mu^2 = -c^2,\quad\text{or}\quad U_\mu^2 = -c^2 - \omega^2\rho^2 &lt; -c^2
\tag{23.20}\]</span></span></p>
<p><a href="#eq-sqr-v-invariance1" class="quarto-xref">Equation&nbsp;<span>23.20</span></a> is of crucial importance in the GCA formalism, because the drift motion <span class="math inline">\(U_\mu\)</span> is the mean motion separated from the gyration and corresponds to the GC motion itself, meaning that what we just found is a relation between the energy and momentum of a particle guiding center. It is very similar to the well-known formula of the squared four-velocity <span class="math inline">\({U_\mu^\prime}^2=-c^2\)</span>, the only difference being an additional term <span class="math inline">\(\omega^2\rho^2\)</span>. This suggests interpreting the motion of the GC as the one of a particle located in the center of gyration, performing no gyration and possessing a squared four velocity as stated in <a href="#eq-sqr-v-invariance1" class="quarto-xref">Equation&nbsp;<span>23.20</span></a>, in agreement with part of the particle kinetic energy being stored in the gyration motion through the term <span class="math inline">\(\omega^2\rho^2\)</span>. By separating the spatial and temporal parts of <span class="math inline">\(U_\mu\)</span> and rearranging some terms inside <a href="#eq-sqr-v-invariance1" class="quarto-xref">Equation&nbsp;<span>23.20</span></a>, we can get a relation for the GC Lorentz factor <span id="eq-gc-gamma"><span class="math display">\[
\gamma_\text{GC} = \sqrt{1+\frac{|\mathbf{U}|^2}{c^2} + \frac{\omega^2\rho^2}{c^2}} = \sqrt{1+\frac{\gamma^2|\mathbf{v}|^2}{c^2} + \frac{\omega^2\rho^2}{c^2}}
\tag{23.21}\]</span></span></p>
<p>Although we only considered a limit case, the same equation can be proven to be generally valid in the GCA formalism.</p>
<p>We now want to isolate the gyration motion in a general case. This is done by separating the motion as follows: <span id="eq-gc-separation-of-motion"><span class="math display">\[
x_\mu = \xi_\mu x + \eta_\mu y + x_\mu^\prime + X_\mu
\tag{23.22}\]</span></span> where <span class="math inline">\(x_\mu\)</span> is the space-time position of the particle and <span class="math inline">\(X_\mu\)</span> is the position of the guiding center. We associate two variables <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> to describe the periodic motion in the <span class="math inline">\((\xi, \eta)\)</span>-plane, and the term <span class="math inline">\(x_\mu^\prime\)</span> will account for the periodic motions which do not lie in the same plane. To more easily describe the gyration, we also choose a new pair of variables <span id="eq-gc-new-vars"><span class="math display">\[
\zeta = \frac{1}{\sqrt{2}}\left( x+ iy \right)\quad\text{and}\quad \zeta^\ast = \frac{1}{\sqrt{2}}\left( x - iy \right)
\tag{23.23}\]</span></span> so that <span class="math inline">\(\xi_\mu x + \eta_\mu y = \delta_\mu\zeta + \sigma_\mu\zeta^\ast\)</span>. The new variables will allow us to choose <span class="math inline">\(\zeta_\mu\)</span> and <span class="math inline">\(\delta_\mu\)</span> in a more convenient way and let some factor <span class="math inline">\(e^{i\phi}\)</span> account for the initial conditions of the problem. We rewrite the particle coordinate using <span class="quarto-unresolved-ref">?eq-gc-new-variables</span> <span id="eq-eq-gc-new-vars2"><span class="math display">\[
x_\mu = \delta_\mu\zeta + \sigma_\mu\zeta^\ast + x_\mu^\prime + X_\mu
\tag{23.24}\]</span></span></p>
<p>The next step is substituting this expression into <a href="#eq-charged-particle-motion-general" class="quarto-xref">Equation&nbsp;<span>23.11</span></a> and expand the second derivative, which leads to a lengthy expression containing eight unkowns: <span class="math inline">\(\zeta,\zeta^\ast\)</span>, two components of <span class="math inline">\(x_\mu\)</span> (the condition with the <span class="math inline">\((\sigma, \delta)\)</span>-plane sets the other two), and four components of <span class="math inline">\(X_\mu\)</span>.</p>
<p>The conditions for the GCA expressed in <a href="#eq-gca-condition2" class="quarto-xref">Equation&nbsp;<span>23.14</span></a> implicitly contain a parameter of smallness <span class="math inline">\(\epsilon =|u/\omega L|\ll 1\)</span>, where u is the typical particle four-velocity and L the scale length upon which the change in the EM fields <span class="math inline">\(F_{\mu\nu}\)</span> is comparable to <span class="math inline">\(F_{\mu\nu}\)</span> (slowly-varying fields approximation). This allows us to approximate <span class="math inline">\(F_{\mu\nu}(x_\mu)\)</span> (particle coordinate) by using a Taylor expansion about <span class="math inline">\(X_\mu\)</span> (the GC coordinate) <span class="math display">\[
\begin{aligned}
F_{\mu\nu}(x_\mu) =&amp; F_{\mu\nu}(X_\mu) \\
&amp;+ \frac{\partial F_{\mu\nu}}{\partial x_\xi}(\delta_\xi \zeta + \sigma_\xi \zeta^\ast) \\
&amp;+ \frac{1}{2} \frac{\partial^2 F_{\mu\nu}}{\partial x_\xi\partial x_\pi}\left[ \delta_\xi\delta_\pi \zeta^2 + \sigma_\xi\sigma_\pi {\zeta^\ast}^2 + (\sigma_\xi \delta_\pi + \sigma_\pi \delta_\xi)|\zeta|^2 \right] \\
&amp;+ \frac{\partial F_{\mu\nu}}{\partial x_\xi} x_\xi^\prime + ...
\end{aligned}
\]</span></p>
<p>We should now substitute <span class="math inline">\(F_{\mu\nu}(x_\mu)\)</span> inside <a href="#eq-charged-particle-motion-general" class="quarto-xref">Equation&nbsp;<span>23.11</span></a> using the new coordinates in order to get a quite long equation containing all quantities evaluated at the GC position <span class="math inline">\(X_\mu\)</span> up to 2nd−order, and group all 2nd−order terms on the right-end side as <span class="math inline">\(G_\mu\)</span> <span id="eq-gc-expansion"><span class="math display">\[
\begin{aligned}
&amp;\delta_\mu\frac{\mathrm{d}^2\zeta}{\mathrm{d}\tau^2} + \sigma_\mu\frac{\mathrm{d}^2\zeta^\ast}{\mathrm{d}\tau^2}+\left( i\omega\delta_\mu + 2\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} \right)\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} \\
&amp;+\left( -i\omega\sigma_\mu + 2\frac{\mathrm{d}\sigma_\mu}{\mathrm{d}\tau} \right) \frac{\mathrm{d}\zeta^\ast}{\mathrm{d}\tau} + \frac{\mathrm{d}^2\delta_\mu}{\mathrm{d}\tau^2}\zeta + \frac{\mathrm{d}^2\sigma_\mu}{\mathrm{d}\tau^2}\zeta^\ast \\
&amp;- \frac{\partial F_{\mu\nu}}{\partial x_\xi}\left( \delta_\xi \zeta + \sigma_\xi \zeta^\ast \right)\frac{\mathrm{d}X_\nu}{\mathrm{d}\tau} - F_{\mu\nu}\left( \frac{\mathrm{d}\delta_\nu}{\mathrm{d}\tau}\zeta + \frac{\mathrm{d}\sigma_\nu}{\mathrm{d}\tau}\zeta^\ast \right) \\
&amp;- \frac{\partial F_{\mu\nu}}{\partial x_\xi}\left( \delta_\xi \zeta + \sigma_\xi \zeta^\ast \right) \left( \delta_\nu\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} + \sigma_\nu\frac{\mathrm{d}\zeta^\ast}{\mathrm{d}\tau} \right) \\
&amp;+ \left( \frac{\mathrm{d}^2 X_\nu}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}X_\mu}{\mathrm{d}\tau} \right) + \left( \frac{d^2 x_\mu^\prime}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}x_\nu^\prime}{\mathrm{d}\tau} \right) = G_\mu
\end{aligned}
\tag{23.25}\]</span></span></p>
<p>An expression for <span class="math inline">\(\zeta\)</span> is needed to further proceed, but since the derivation is quite long we will not explicitly derive it here. The basic idea is to use the orthogonality equations for the new four-vectors <span class="math inline">\(\sigma_\mu\)</span> and <span class="math inline">\(\delta_\mu\)</span> and the antisymmetry property of the EM tensor inside Maxwell’s equations written in tensorial form, and then assume that a solution for <span class="math inline">\(X_\mu\)</span> has already been found. Considered that <span class="math inline">\(x_\mu\)</span> is a 1st−order term in the GCA, by ignoring 2nd−order quantities and writing terms independent from <span class="math inline">\(\zeta\)</span> as a numerical value <span class="math inline">\(P\)</span>, then <a href="#eq-gc-expansion" class="quarto-xref">Equation&nbsp;<span>23.25</span></a> becomes <span id="eq-gc-expansion2"><span class="math display">\[
\frac{\mathrm{d}^2\zeta}{\mathrm{d}\tau^2} + i\Omega\frac{\mathrm{d}\zeta}{\mathrm{d}\tau} + \frac{i}{2}\frac{\mathrm{d}\Omega}{\mathrm{d}\tau}\zeta + \Omega a \zeta + P = 0
\tag{23.26}\]</span></span> where <span class="math inline">\(\Omega a \zeta\)</span> contains all the linear terms in <span class="math inline">\(\zeta\)</span>. Consequently, the corresponding solution <span class="math inline">\(\zeta\)</span>, by analogy to the <em>Wentzel–Kramers–Brillouin (WKB)</em> approximation in quantum mechanics, is <span id="eq-gc-wkb"><span class="math display">\[
\zeta = \rho_0 \sqrt{\frac{\omega_0}{\Omega}}\exp\left[ -i\left( \Phi + \int_{\tau_0}^\tau \sigma_1 \mathrm{d}\tau \right) \right]
\tag{23.27}\]</span></span> to the 0th-order, being <span id="eq-gc-wkb2"><span class="math display">\[
\Omega = \omega - 2i\sigma_\mu \frac{\mathrm{d}\delta_\mu}{\mathrm{d}\tau},\quad \Phi = \int_{\tau_0}^{\tau}\Omega\mathrm{d}\tau - \phi,\quad\text{and} \sigma = a - \frac{a^2}{\Omega}
\tag{23.28}\]</span></span> The subscripts 0, 1 indicate the associated order of approximation for quantities defined above.</p>
<p>Since now we know the expression for <span class="math inline">\(\zeta\)</span>, we can write the 1st−order EOM for <span class="math inline">\(X_\mu\)</span>. For this purpose, we require that in the left-end side of <a href="#eq-gc-expansion" class="quarto-xref">Equation&nbsp;<span>23.25</span></a> the terms containing the 1st− and 2nd−order derivatives of <span class="math inline">\(X_\mu\)</span> are balanced by the remaining nonoscillatory terms, that is <span id="eq-gc-balance"><span class="math display">\[
\frac{\mathrm{d}^2 X_\mu}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}X_\nu}{\mathrm{d}\tau} = \frac{\partial F_{\mu\nu}}{\partial x_\xi}\left( \delta_\xi \sigma_\nu \frac{\mathrm{d}\zeta^\ast}{\mathrm{d}\tau} + \delta_\nu \sigma_\xi \frac{\mathrm{d}\zeta}{\mathrm{d}\tau} \right)
\tag{23.29}\]</span></span></p>
<p>Having found the solution <a href="#eq-gc-wkb" class="quarto-xref">Equation&nbsp;<span>23.27</span></a> and making use once again of the orthogonality relations for <span class="math inline">\(\delta_\mu\)</span> and <span class="math inline">\(\sigma_\mu\)</span> and the tensorial Maxwell’s equations, we can write the equation of motion for the GC <span id="eq-gc-eom"><span class="math display">\[
\frac{\mathrm{d}^2 X_\mu}{\mathrm{d}\tau^2} - F_{\mu\nu}\frac{\mathrm{d}X_\nu}{\mathrm{d}\tau} + \rho_0^2 \omega_0\frac{\partial\omega}{\partial x_\mu} = 0
\tag{23.30}\]</span></span> where <span class="math inline">\(\omega\)</span> (<a href="#eq-EM-eigenvalues" class="quarto-xref">Equation&nbsp;<span>23.15</span></a>) is the generalized Larmor frequency, <span class="math inline">\(\rho_0^2 \omega_0 = \mu_0 = mc\gamma^2 v_\perp^2 / 2eB\)</span> is the 0th-order approximation (apart from a constant factor) to the particle magnetic moment <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\omega_0 = eB/(mc)\)</span> represents the lowest-order approximation to the Larmor frequency in the case <span class="math inline">\(E\ll B\)</span>.</p>
<p>More precisely, the magnetic moment should be regarded as constant only in the reference frame moving at <span class="math inline">\(\mathbf{v}_E\)</span>, because in that particular case <span class="math inline">\(\mathbf{E} = 0\)</span>. Indeed, a formal analysis (<span class="citation" data-cites="northrop1960stability">Northrop and Teller (<a href="#ref-northrop1960stability" role="doc-biblioref">1960</a>)</span>) shows that the corresponding constant of motion in a general reference frame is actually an asymptotic series expansion in a smallness parameter <span class="math inline">\(\epsilon=u/(\omega_0 L)\)</span> in the form <span class="math inline">\(\mu = (e/c)\left[ \mu_0 + \epsilon \mu_1 + \epsilon^2 \mu_2 + ... \right]\)</span> so that <span class="math inline">\(\mu_0\)</span> is not constant and can still vary in compliance with the adiabatic theory. Nevertheless, extensive numerical testing confirms that the errors due to assuming <span class="math inline">\(\mathrm{d}\mu_0 / \mathrm{d}t \approx 0\)</span> are at most of the same order of those introduced by the GC formalism, as a consequence of the slowly varying field condition which prevents sensible changes in the magnetic moment. Hence, we safely assume that <span class="math inline">\(\mu \approx (e/c)\mu_0\)</span> is invariant.</p>
</section>
<section id="first-order-solution-for-the-gca-equations-of-motion" class="level2" data-number="23.5">
<h2 data-number="23.5" class="anchored" data-anchor-id="first-order-solution-for-the-gca-equations-of-motion"><span class="header-section-number">23.5</span> First Order Solution for the GCA Equations of Motion</h2>
<p>Although deceitful simple, the GC equation of motion <a href="#eq-gc-eom" class="quarto-xref">Equation&nbsp;<span>23.30</span></a> is more conveniently cast in a form in which the GC velocity appears explicitly, under the nearly-crossed (EM) fields condition <span id="eq-nearly-cross-em"><span class="math display">\[
\frac{\mathbf{E}_\parallel \cdot\mathbf{B}}{B^2 - E_\perp^2} \ll 1
\tag{23.31}\]</span></span> where the subscripts <span class="math inline">\(\parallel\)</span> and <span class="math inline">\(\perp\)</span> indicate the parallel and perpendicular components of the electric field with respect to the magnetic field unit vector <span class="math inline">\(\hat{b}\)</span>. It can be proven that <a href="#eq-nearly-cross-em" class="quarto-xref">Equation&nbsp;<span>23.31</span></a> allows the EM tensor field <span class="math inline">\(F_{\mu\nu}\)</span> to be split into a contribution <span class="math inline">\(F_{\mu\ni}^{(0)}\)</span> constructed solely from <span class="math inline">\(\mathbf{E}_\perp\)</span> and <span class="math inline">\(\mathbf{B}\)</span>, plus a correction term <span class="math inline">\(F_{\mu\nu}^{(1)}\)</span> depending on <span class="math inline">\(\mathbf{E}_\parallel\)</span>. A formal analysis leads to the conclusion that the GC four-velocity <span class="math inline">\(U_\mu \equiv \mathrm{d}X_\mu/\mathrm{d}\tau\)</span> can be decomposed into a 0th-order contribution <span class="math inline">\(\mathrm{U}^{(0)}\)</span> (which contains the drift velocity <span class="math inline">\(\mathbf{v}_E = c\mathbf{E}_\perp \times\mathbf{B}/B^2\)</span> as well as the velocity component parallel to the magnetic field line <span class="math inline">\(v_\parallel \hat{b}\)</span>) plus 1st-order correction <span class="math inline">\(\mathbf{U}^{(1)}\)</span>, leading to <span id="eq-four-velocity-decomposition"><span class="math display">\[
U_\mu = (\gamma c, \mathbf{U}) \simeq (\gamma c, \gamma v_\parallel \hat{b} + \gamma \mathbf{v}_E + \mathbf{U}^{(1)})
\tag{23.32}\]</span></span> where <span class="math inline">\(\gamma\)</span> is the particle Lorentz factor <span class="math inline">\(\gamma = (1- v^2/c^2)^{-1/2}\)</span>. An equation for <span class="math inline">\(\mathbf{U}^{(1)}\)</span> can be derived from <a href="#eq-gc-eom" class="quarto-xref">Equation&nbsp;<span>23.30</span></a> using a recursive approach as shown below, while from the spatial component one obtains an equation (to the same order) for the parallel component of the GC four-velocity <span class="math inline">\(\gamma v_\parallel\)</span>. These yield the (1st-order) GCA system of ordinary differential equations (ODEs) <span id="eq-gc-eom-1st-sol"><span class="math display">\[
\begin{aligned}
\frac{\mathrm{d}\mathbf{X}}{\mathrm{d}t} &amp;= \mathbf{v}_E + v_\parallel \hat{b} + \frac{\gamma_E^2}{B}\hat{b}\times\left[ \frac{mc\gamma}{e}\left( v_\parallel\mathcal{L}(\hat{b}) + \mathcal{L}(\mathbf{v}_E) \right) + \mathcal{M}\left( \frac{B}{\gamma_E} \right) + \frac{v_\parallel E_\parallel}{c}\mathbf{v}_E \right] \\
\frac{\mathrm{d}(\gamma v_\parallel)}{\mathrm{d}t} &amp;= \frac{e}{m}E_\parallel - \gamma\hat{b}\cdot\mathcal{L}(\mathbf{v}_E) - \frac{\mu}{\gamma m}\hat{b}\cdot\nabla\left(\frac{B}{\gamma_E}\right)
\end{aligned}
\tag{23.33}\]</span></span> where <span class="math inline">\(\mathrm{d}\mathbf{X}/\mathrm{d}t = \mathbf{U}^{(1)}/\gamma\)</span> represents the velocity of the guiding center, <span class="math inline">\(e/m\)</span> is the particle charge-to-mass ratio and <span class="math inline">\(\mu_0 = c\mu/e\)</span>. The operators <span class="math inline">\(\mathcal{L}\)</span> and <span class="math inline">\(\mathcal{M}\)</span> are defined as <span id="eq-gc-eom-1st-operator"><span class="math display">\[
\begin{aligned}
\mathcal{L}(x) &amp;= \frac{\partial\mathbf{x}}{\partial t} + v_\parallel(\hat{b}\cdot\nabla)\mathbf{x} + (\mathbf{v}_E\cdot\nabla)\mathbf{x} \\
\mathcal{M}(x) &amp;= \frac{\mu}{e\gamma}\left[ \frac{\mathbf{v}_E}{c}\frac{\partial x}{\partial t} + c\nabla x \right]
\end{aligned}
\tag{23.34}\]</span></span> where <span class="math inline">\(\gamma_E = (1 - E_\perp^2/B^2)^{-1/2}\)</span> is the Lorentz factor associated to the drift velocity <span class="math inline">\(\mathbf{v}_E\)</span>.</p>
<p>In the GCA <a href="#eq-gc-eom-1st-sol" class="quarto-xref">Equation&nbsp;<span>23.33</span></a> information about motion perpendicular to the magnetic field is lost and the only component of the particle velocity that is actually evolved in time is <span class="math inline">\(u_\parallel\)</span>, because the magnetic moment <span class="math inline">\(\mu_0\approx c\mu/e\)</span> is now considered a constant of motion. Each term on the right hand side of <a href="#eq-gc-eom-1st-sol" class="quarto-xref">Equation&nbsp;<span>23.33</span></a> corresponds to a specific drift motion. Indeed, the first term represents the <span class="math inline">\(\mathbf{E}\times\mathbf{B}\)</span> perpendicular drift, while the second one accounts for particle motion in the direction parallel to magnetic field. The first two terms in square bracket, <span class="math inline">\(\mathcal{L}(\hat{b})\)</span> and <span class="math inline">\(\mathcal{L}(\mathbf{v}_E)\)</span>, describe the field curvature and polarization drifts<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, respectively. The next term is the <span class="math inline">\(\nabla-B\)</span> drift, while the last one represents a relativistic drift in the direction given by <span class="math inline">\(\hat{b}\times\mathbf{v}_E\)</span>.</p>
<p><a href="#eq-gc-eom-1st-sol" class="quarto-xref">Equation&nbsp;<span>23.33</span></a> lose their validity when either <span class="math inline">\(B\to 0\)</span> (magnetic null) or <span class="math inline">\(E_\perp \ge B\)</span>, i.e.&nbsp;when the nearly-crossed EM fields condition, <a href="#eq-nearly-cross-em" class="quarto-xref">Equation&nbsp;<span>23.31</span></a>, is violated. While the first condition can easily occur inside a current sheet, the second may occur in a non-ideal MHD regime only. Violation of either condition breaks down the GCA and can lead to severe numerical errors.</p>
<section id="recursive-solution" class="level3" data-number="23.5.1">
<h3 data-number="23.5.1" class="anchored" data-anchor-id="recursive-solution"><span class="header-section-number">23.5.1</span> Recursive solution</h3>
<p>An explicit solution for <a href="#eq-gc-eom" class="quarto-xref">Equation&nbsp;<span>23.30</span></a> can be found under <a href="#eq-nearly-cross-em" class="quarto-xref">Equation&nbsp;<span>23.31</span></a>, which introduces a new parameter of smallness <span class="math inline">\(\lambda / \omega \ll 1\)</span>.</p>
</section>
<section id="energy-conservation" class="level3" data-number="23.5.2">
<h3 data-number="23.5.2" class="anchored" data-anchor-id="energy-conservation"><span class="header-section-number">23.5.2</span> Energy conservation</h3>
<p>The time component of <a href="#eq-gc-eom" class="quarto-xref">Equation&nbsp;<span>23.30</span></a> leads to an evolutionary ODE for the particle energy as a function of time, namely <span id="eq-gc-eom-time"><span class="math display">\[
\frac{\mathrm{d}\gamma c^2}{\mathrm{d}t} = \frac{e}{m}\frac{\mathrm{d}\mathbf{X}}{\mathrm{d}t}\cdot\mathbf{E} + \frac{\mu}{m}\frac{\partial}{\partial t}\left( \frac{B}{\gamma_E} \right)
\tag{23.35}\]</span></span></p>
<p>In the time-independent case, <a href="#eq-gc-eom-time" class="quarto-xref">Equation&nbsp;<span>23.35</span></a> clearly shows that, when the GC velocity is perpendicular to the electric field, no acceleration occurs and the particle energy is conserved. For numerical purposes, however, <a href="#eq-gc-eom-time" class="quarto-xref">Equation&nbsp;<span>23.35</span></a> is not solved for retrieving the Lorentz <span class="math inline">\(\gamma\)</span>-factor, since large values of the right hand side could easily violate the condition <span class="math inline">\(\gamma\ge 1\)</span> at the truncation level of the scheme, unless small time steps are taken. In practice, to an 1st-order approximation, the particle velocity can be decomposed into a parallel component <span class="math inline">\(v_\parallel\)</span>, a drift component <span class="math inline">\(v_E\)</span> and a gyration component <span class="math inline">\(v_\perp\)</span>. This leads to the normalization condition <span id="eq-gc-eom-normalization-1st"><span class="math display">\[
\gamma^2( c^2 - v_\parallel^2 - v_\perp^2 - v_E^2) = c^2
\tag{23.36}\]</span></span></p>
<p>From the definition of the magnetic moment and the Larmor frequency <span class="math inline">\(\mu_0 = mc\gamma^2 v_\perp^2/(2eB) = \gamma^2 v_\perp^2/(2\omega_0)\)</span>, we compute the particle Lorentz factor as <span id="eq-gc-eom-lorentz"><span class="math display">\[
\gamma = \sqrt{\frac{c^2 + \gamma^2 v_\parallel^2 + 2\mu_0 \omega_0}{c^2 - v_E^2}}
\tag{23.37}\]</span></span></p>
<p><a href="#eq-gc-eom-lorentz" class="quarto-xref">Equation&nbsp;<span>23.37</span></a> replaces <a href="#eq-gc-eom-time" class="quarto-xref">Equation&nbsp;<span>23.35</span></a> in common numerical solvers to get the Lorentz factor.</p>
</section>
<section id="numerical-implementation" class="level3" data-number="23.5.3">
<h3 data-number="23.5.3" class="anchored" data-anchor-id="numerical-implementation"><span class="header-section-number">23.5.3</span> Numerical implementation</h3>
<p>The GCA <a href="#eq-gc-eom-1st-sol" class="quarto-xref">Equation&nbsp;<span>23.33</span></a> contains a set of 4 ODEs with unknowns <span class="math inline">\((\mathbf{X}, u_\parallel)\)</span>. The terms which require evaluation at grids are</p>
<ul>
<li><span class="math inline">\(\mathbf{B}\)</span></li>
<li><span class="math inline">\(c\mathbf{E}\)</span></li>
<li><span class="math inline">\((\hat{b}\cdot\nabla)\hat{b}\)</span></li>
<li><span class="math inline">\((\hat{b}\cdot\nabla)\mathbf{v}_E\)</span></li>
<li><span class="math inline">\((\mathbf{v}_E\cdot\nabla)\mathbf{v}_E\)</span></li>
<li><span class="math inline">\((\mathbf{v}_E\cdot\nabla)\hat{b}\)</span></li>
<li><span class="math inline">\(\nabla(B/\gamma_E)\)</span></li>
</ul>
<section id="nonrelativistic-case" class="level4" data-number="23.5.3.1">
<h4 data-number="23.5.3.1" class="anchored" data-anchor-id="nonrelativistic-case"><span class="header-section-number">23.5.3.1</span> Nonrelativistic case</h4>
<p>In the nonrelativistic case, <span class="math inline">\(\gamma = 1\)</span> so we don’t need to solve <a href="#eq-gc-eom-lorentz" class="quarto-xref">Equation&nbsp;<span>23.37</span></a>. <a href="#eq-gc-eom-1st-sol" class="quarto-xref">Equation&nbsp;<span>23.33</span></a> can be simplified into <span id="eq-gc-eom-1st-sol-nonrelativistic"><span class="math display">\[
\begin{aligned}
\frac{\mathrm{d}\mathbf{X}}{\mathrm{d}t} &amp;=  \\
\frac{\mathrm{d}(v_\parallel)}{\mathrm{d}t} &amp;=
\end{aligned}
\tag{23.38}\]</span></span></p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-northrop1960stability" class="csl-entry" role="listitem">
Northrop, Theodore G, and Edward Teller. 1960. <span>“Stability of the Adiabatic Motion of Charged Particles in the Earth’s Field.”</span> <em>Physical Review</em> 117 (1): 215. <a href="https://doi.org/10.1103/PhysRev.117.215">https://doi.org/10.1103/PhysRev.117.215</a>.
</div>
<div id="ref-vandervoort1960relativistic" class="csl-entry" role="listitem">
Vandervoort, Peter O. 1960. <span>“The Relativistic Motion of a Charged Particle in an Inhomogeneous Electromagnetic Field.”</span> <em>Annals of Physics</em> 10 (3): 401–53. <a href="https://doi.org/10.1016/0003-4916(60)90004-X">https://doi.org/10.1016/0003-4916(60)90004-X</a>.
</div>
</div>
</section>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>The four-velocity defined here using the proper time of an object does not exist for world lines for massless objects such as photons travelling at the speed of light.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For verification simply substitute <span class="math inline">\(x_\mu\)</span> and <span class="math inline">\(U_\mu\)</span> in the left and right-end side of <a href="#eq-charged-particle-motion-general" class="quarto-xref">Equation&nbsp;<span>23.11</span></a>, respectively, to find that <span class="math inline">\(F_{\mu\nu} U_\nu = 0\)</span>, and rewrite the indexes of such equation explicitly.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Notice that the <span class="math inline">\(\mathcal{L}()\)</span> operator is the Lagrangian derivative <span class="math inline">\(\mathrm{d}/\mathrm{d}t\)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../contents/aurora.html" class="pagination-link" aria-label="Aurora">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Aurora</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../contents/cr.html" class="pagination-link" aria-label="Cosmic Ray">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Cosmic Ray</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/henry2004y/KeyNotes/edit/master/contents/gc.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>