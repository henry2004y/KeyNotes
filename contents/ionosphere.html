<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Key Notes in Plasma Physics - 23&nbsp; Ionosphere</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../contents/radiationbelt.html" rel="next">
<link href="../contents/magnetosphere.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../contents/ionosphere.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ionosphere</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Key Notes in Plasma Physics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/henry2004y/KeyNotes/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Math</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/theoretical_mechanics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Theoretical Mechanics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/relativity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Relativity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/unit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Unit Conversion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/single.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Single-Particle Motions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/fluid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Plasmas as Fluid</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/diffres.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Diffusion and Resisvity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/wave.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Waves</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/emhd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">EMHD</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/kinetic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Kinetic Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/stability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Stability</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/kmhd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Kinetic MHD</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/gyrokinetics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Gyrokinetics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/flr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Field Line Resonance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Nonlinear Effects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/turbulence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Turbulence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/geometry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Geometry</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/solarwind.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Solar Wind</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/shock.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Shock</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/magnetosphere.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Magnetosphere</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/ionosphere.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ionosphere</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/radiationbelt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Radiation Belt</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/aurora.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Aurora</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/gc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Guiding Center</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/cr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Cosmic Ray</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Boundary Conditions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/pic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Particle-in-Cell</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/hybrid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Hybrid Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/raytracing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Ray Tracing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/inductance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Inductance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/capacitance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Capacitance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#current-systems" id="toc-current-systems" class="nav-link active" data-scroll-target="#current-systems"><span class="header-section-number">23.1</span> Current Systems</a></li>
  <li><a href="#sec-MI_coupling" id="toc-sec-MI_coupling" class="nav-link" data-scroll-target="#sec-MI_coupling"><span class="header-section-number">23.2</span> M-I Coupling</a>
  <ul class="collapse">
  <li><a href="#caveats" id="toc-caveats" class="nav-link" data-scroll-target="#caveats"><span class="header-section-number">23.2.1</span> Caveats</a></li>
  </ul></li>
  <li><a href="#ionosphere-modeling" id="toc-ionosphere-modeling" class="nav-link" data-scroll-target="#ionosphere-modeling"><span class="header-section-number">23.3</span> Ionosphere Modeling</a>
  <ul class="collapse">
  <li><a href="#chemistry" id="toc-chemistry" class="nav-link" data-scroll-target="#chemistry"><span class="header-section-number">23.3.1</span> Chemistry</a></li>
  <li><a href="#ion-advection" id="toc-ion-advection" class="nav-link" data-scroll-target="#ion-advection"><span class="header-section-number">23.3.2</span> Ion Advection</a></li>
  </ul></li>
  <li><a href="#ionosphere-waveguide" id="toc-ionosphere-waveguide" class="nav-link" data-scroll-target="#ionosphere-waveguide"><span class="header-section-number">23.4</span> Ionosphere Waveguide</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/henry2004y/KeyNotes/edit/master/contents/ionosphere.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-iono" class="quarto-section-identifier"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ionosphere</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Ionosphere is like a transition region from neutral gas to plasma. Therefore, collisions as well as kinetic effects may become important. <a href="diffres.html#sec-collision_ionized" class="quarto-xref"><span>Section 9.8</span></a> presents some basic physics related to the collisional effect in the ionosphere.</p>
<section id="current-systems" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="current-systems"><span class="header-section-number">23.1</span> Current Systems</h2>
<p>Electric fields associated with the viscous interaction and reconnection-driven plasma flow are transmitted along field lines to the ionosphere where they drive currents through the ionosphere. The high latitude FAC are known as <em>region-1 currents</em>, while the lower latitude currents are called <em>region-2 currents</em>. The ionospheric current connecting these two FAC systems flows parallel to the projected electric field and is called the <em>Pedersen current</em>. Since the Pedersen current flows through a resistive ionosphere in the direction of the electric field it causes Ohmic heating <span class="math inline">\(\mathbf{j}\cdot\mathbf{E}&gt;0\)</span>. The two shells of FAC form a solenoid so that the magnetic perturbations they create are confined to the region between them and cannot be detected on the ground. Because of the interaction of the motion of ionized gases with the neutral atmosphere, the ions and electrons undergo different drift motion. Ions, due to higher collision rates with the neutral atmosphere, have a component of motion perpendicular to the <span class="math inline">\(\mathbf{E}\times\mathbf{B}\)</span> drift direction, while the electrons generally follow <span class="math inline">\(\mathbf{E}\times\mathbf{B}\)</span>. The non-dissipative (<span class="math inline">\(\mathbf{j}\cdot\mathbf{E}=0\)</span>) Hall current flows at right angles to both the electric and magnetic fields. The magnetic effects of the Hall current driven by the region-1 and 2 currents can be observed on the ground and are known as the DP-2 current system.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>In the context of ionospheric energy dissipation, the different current systems can be classified into two types based on how energy is processed.</p>
<ol type="1">
<li>If the ionospheric motion and dissipation is coupled directly to the solar wind, the system is said to be “directly-driven”. The directly-driven process manifests itself as the DP-2 (two cell pattern) ionospheric current system.</li>
<li>If magnetic energy is first stored in the tail lobes and then released some time later, driving additional convection and field-aligned and ionospheric currents, it is called “unloading”, and is associated with the DP-1 (substorm current wedge) current system.</li>
</ol>
<p>Both processes cause precipitation of charged particles that also deposit energy in the atmosphere.</p>
<p>The characteristic feature of the driven DP-2 current system is the existence of the eastward and westward electrojets flowing toward midnight along the auroral oval. Rough measures of the strength of these currents are the <em>auroral upper</em> (AU) and <em>auroral lower</em> (AL) indices. These are respectively the largest positive northward magnetic perturbation (H) measured on the ground under the eastward electrojet by any magnetic observatory in the afternoon to dusk sector, and the largest negative southward perturbation measured in the late evening to morning sector. Both AU and AL begin to grow in intensity soon after the IMF turns southward and dayside reconnection begins. The characteristic feature of the unloading DP-1 current system is the sudden development of an additional westward current that flows across the bright region of the expanding auroral bulge. This is the ionospheric segment of the substorm current wedge. The onset of this current is recorded in the AL index as a sudden decrease, corresponding to an increase in intensity of the westward current.</p>
</section>
<section id="sec-MI_coupling" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="sec-MI_coupling"><span class="header-section-number">23.2</span> M-I Coupling</h2>
<p>Ionospheric properties, principally conductivity, provide boundary conditions for magnetospheric convection, and the ionosphere is often treated as a passive part of the system. Especially during substorms, however, the boundary conditions change in a time-dependent and spatially localized fashion, allowing ionospheric feedback that can alter the magnetospheric dynamics. The coupling from the ionospheric perspective differs primarily in that the ionospheric conductance is anisotropic due to the influence of the neutral atmosphere, involving Hall as well as Pedersen conductivity. These conductivities are altered both by the connecting currents and the precipitating electrons associated with upward field-aligned currents, which increase Pedersen conductivity and field line tying. An important role is also played by field-aligned electric fields, set up locally, primarily in upward field-aligned current regions, which are the cause of auroral intensifications and, specifically auroral arcs.</p>
<p>For magnetosphere simulations, the simplest inner boundary is treated as a conducting sphere (<span class="math inline">\(\mathbf{B}_\text{normal}=0\)</span>, <span class="math inline">\(\mathbf{E}=\mathbf{v}=0\)</span>). However, this is often not realistic enough to reveal the nature. In magnetosphere simulations, the location of tail main reconnection site will be closer to the Earth by simply applying a conducting boundary. The next level extension is to employ a magnetospheric-ionospheric electrostatic coupling model. This means that we seek nonzero <span class="math inline">\(\mathbf{E}\)</span> and <span class="math inline">\(\mathbf{v}\)</span> at the inner boundary. The inner boundary, where the MHD quantities are connected to the ionosphere, is taken to be a shell of radius <span class="math inline">\(r_\text{in}\)</span> (e.g.&nbsp;<span class="math inline">\(r_\text{in}\sim 3\,\text{R}_\text{E}\)</span>). The ionosphere locates at <span class="math inline">\(r_\text{ion}\sim 1000\,\text{km}\sim 0.15\,\text{R}_\text{E}\)</span>. Ideally <span class="math inline">\(r_\text{in}\)</span> shall be as close to <span class="math inline">\(r_\text{ion}\)</span> as possible, but typically it is restricted by computational limitations, such as extraneously high Alfvén speeds and very large <span class="math inline">\(\mathbf{B}\)</span> field gradients closer to the Earth. Inside this shell we do not solve the governing equations (MHD/PIC/Vlasov), but assume a static dipole field. The important physical processes within the shell are the flow of <em>field-aligned currents</em> (FACs) and the closure of these currents in the ionosphere. At each time step,</p>
<ol type="1">
<li><p>The magnetospheric FACs are mapped along the field lines from the inner boundary to the ionosphere assuming <span class="math inline">\(j_\parallel/B=\text{const.}\)</span>, which are the input to the ionospheric potential equation <span class="citation" data-cites="raeder1995">(<a href="#ref-raeder1995" role="doc-biblioref">Raeder, Walker, and Ashour-Abdalla 1995</a>)</span> <span id="eq-ionosphere_potential"><span class="math display">\[
\nabla\cdot(\pmb{\Sigma}\cdot\nabla\Phi) = -j_\parallel\sin I
\tag{23.1}\]</span></span> where <span class="math inline">\(\pmb{\Sigma}\)</span> is the conductance tensor, <span class="math inline">\(\Phi\)</span> is the electric potential, <span class="math inline">\(j_\parallel\)</span> is the mapped FAC density with the downward considered positive and corrected for flux tube convergence, and <span class="math inline">\(I\)</span> is the inclination of the dipole field at the ionosphere, <span class="math inline">\(\sin I=\cos(\frac{\pi}{2}-I)=\hat{b}\cdot\hat{r}\)</span>. The derivation from the charge conservation can be found in <a href="diffres.html#sec-conductivity" class="quarto-xref"><span>Section 9.8.7</span></a>. There is another form derived by [Wolf 1983]: <span id="eq-ionosphere_potential2"><span class="math display">\[
\nabla_\perp\cdot
\begin{pmatrix} \sigma_P/\cos^2\delta &amp; -\sigma_H\cos\delta \\ \sigma_H/\cos\delta &amp; \sigma_P \end{pmatrix} \cdot\nabla_\perp\Phi =
j_\parallel\cos\delta
\tag{23.2}\]</span></span> where <span class="math inline">\(\delta\)</span> is the magnetic field dip angle: <span class="math display">\[
\cos\delta = -2\frac{\cos\theta}{\sqrt{1+3\cos^2\theta}}
\]</span> for the northern hemisphere, where <span class="math inline">\(\theta\)</span> is the polar angle (magnetic colatitude). I DON’T KNOW THE RELATION BETWEEN THESE TWO!</p></li>
<li><p><a href="#eq-ionosphere_potential" class="quarto-xref">Equation&nbsp;<span>23.1</span></a> is solved on the surface of a sphere <span class="math inline">\(r=r_\text{ion}\)</span>. Commonly there are two types of boundary conditions: (1) <span class="math inline">\(\Phi=0\)</span> at the equator <span class="citation" data-cites="raeder1995">(<a href="#ref-raeder1995" role="doc-biblioref">Raeder, Walker, and Ashour-Abdalla 1995</a>)</span>, or (2) constant potential at or near the low‐latitude boundary (e.g.&nbsp;LFM, BATSRUS). From here, one can either choose a static analytic model of Hall and Pederson conductance that accounts for multiple physics, or simply adopt a uniform Pederson conductance, or the height-integrated conductivity, <span class="math inline">\(\Sigma_p = 5\,\text{Siemens}\)</span>, while the Hall conductance <span class="math inline">\(\Sigma_H\)</span> is assumed to be zero. The latter one is simplified to solve <span class="math display">\[
\nabla^2\Phi = -j_\parallel\sin I/\Sigma_p
\]</span></p></li>
</ol>
<p>A more realistic conductance requires considering EUV and diffuse auroral contributions (???) as well. The solar EUV contribution to <span class="math inline">\(\pmb{\Sigma}\)</span> is considered constant in time, but naturally it varies with the solar zenith angle. For example, the empirical formulas by [Moen and Brekke 1993] can be used. The solar EUV radiation is approximated by the 10.7 cm radio flux (commonly known as <em>F10.7</em>), a widely used proxy solar UV activity, whose standard values is taken to be <span class="math inline">\(100\times 10^{-22}\,\text{W}/\text{m}^2\)</span>.</p>
<p>The total conductance can be then expressed as <span class="math display">\[
\Sigma_{P,H} = \sqrt{(\Sigma_{P,H}^{e-})^2 + (\Sigma_{P,H}^{\text{UV}})^2}
\]</span></p>
<p>This is because <span class="math inline">\(\sigma_{P,H}\propto n_e\)</span>, which in a stationary state is proportional to the square root of the production rate, and it is the production rates that can be summed linearly. (???)</p>
<p>Does this look well? Not yet. We know that while the high‐latitude ionospheric convection is driven by the solar wind and magnetosphere interaction, at lower latitudes atmospheric neutral winds start to dominate. The next level approximation needs to take this into account. Because there is a gap between <span class="math inline">\(r_\text{ion}\)</span> and <span class="math inline">\(r_\text{in}\)</span>, the ionospheric footprint of their grid has a low‐latitude boundary somewhere in the midlatitudes, e.g., 45° when <span class="math inline">\(r_\text{in}\sim 2\,\text{R}_\text{E}\)</span> (<a href="#fig-MI-BC" class="quarto-xref">Figure&nbsp;<span>23.1</span></a>). Global magnetospheric models, unless they are fully coupled to models of the inner magnetosphere and the ionosphere, lack details of the ionospheric convection at latitudes equatorward of their low‐latitude ionospheric boundary. To some extent, such details can be translated to the global model via the low‐latitude boundary condition used to solve <a href="#eq-ionosphere_potential2" class="quarto-xref">Equation&nbsp;<span>23.2</span></a>. The easy way is to set the ionospheric potential to zero everywhere on the boundary. This corresponds to no flow across the boundary in the ionosphere or the inner boundary of the magnetosphere simulation in the equatorial plane. The choice of this boundary condition is usually justified by the argument that it helps to shield the inner magnetosphere from the cross‐tail electric field.</p>
<div id="fig-MI-BC" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-MI-BC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/MI_coupling_BC.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-MI-BC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.1: A schematic depiction of the inner boundary of the magnetosphere simulation and its ionospheric mapping. The location of the low‐latitude boundary of the ionospheric grid is determined by the radius of the inner MHD boundary mapped along the dipole field from the equator. Point A (at 45°) denotes a typical location of the low‐latitude boundary, where the STANDARD and NEUMANN boundary conditions are applied, while point B is where the LOWERBC boundary condition is applied. The three inset plots at the bottom depict schematically the configuration of velocity and electric field vectors with respect to the surface of the ionosphere in a meridional plane. The inset plot titles identify the type of the boundary condition and the point where it is applied. Adopted from <span class="citation" data-cites="merkin2010">(<a href="#ref-merkin2010" role="doc-biblioref">Merkin and Lyon 2010</a>)</span>.
</figcaption>
</figure>
</div>
<p><span class="citation" data-cites="merkin2010">(<a href="#ref-merkin2010" role="doc-biblioref">Merkin and Lyon 2010</a>)</span> tested three different boundary conditions for the potential equation:</p>
<ul>
<li>STANDARD: Dirichlet, the potential at the low‐latitude boundary is set to zero.</li>
<li>NEUMANN: the electric field component normal to the low‐latitude boundary was set to zero. This condition requires all ionospheric plasma to move normal to the boundary.</li>
<li>LOWERBC: Dirichlet, but the location of the low‐latitude boundary was moved to 2° above the equator, thus allowing the plasma to move across the magnetosphere inner boundary. (???) <a href="#eq-ionosphere_potential2_spherical" class="quarto-xref">Equation&nbsp;<span>23.3</span></a> is singular at <span class="math inline">\(\theta=\pi/2\)</span>, which is why the calculation has to stop just short of the equator. (???)</li>
</ul>
<ol start="3" type="1">
<li><p>Sparse linear algebra, GMRES together with an imcomplete LU preconditioner (default for many modern solvers) are usually applied to solve the potential equation. This is generally an easy equation to solve mathematically.</p></li>
<li><p>Once the potential equation is solved the ionospheric potential is mapped back to the <span class="math inline">\(r_\text{in}\)</span> shell and used as a boundary condition for the magnetospheric flow by taking <span class="math inline">\(\mathbf{v}=(-\nabla\Phi)\times\mathbf{B}/B^2\)</span>.</p></li>
</ol>
<section id="caveats" class="level3" data-number="23.2.1">
<h3 data-number="23.2.1" class="anchored" data-anchor-id="caveats"><span class="header-section-number">23.2.1</span> Caveats</h3>
<ul>
<li>The mapping assumes conservation, which is not perfect. In practice <span class="math inline">\(r_\text{in}\sim 4\,\text{R}_\text{E}\)</span> is a minimum requirement for reasonable FACs.</li>
<li>Most numerical codes couples a Cartesian grid to a spherical ionosphere grid, while some couples a spherical grid to a spherical grid. For magnetosphere simulations we need a relatively simple but super fast electric potential solver, therefore structured mesh is often adopted. If a spherical grid is used, care must be taken near the pole since it is a singular from the grid but not physics. <a href="#eq-ionosphere_potential2" class="quarto-xref">Equation&nbsp;<span>23.2</span></a> under spherical coordinates is written as</li>
</ul>
<p><span id="eq-ionosphere_potential2_spherical"><span class="math display">\[
\begin{aligned}
\frac{1}{\sin\theta}&amp;\frac{\partial}{\partial\theta}\Big[ \sin\theta\frac{\Sigma_P}{\cos^2\delta}\frac{\partial\Phi}{\partial\theta} - \frac{\Sigma_H}{\cos\delta}\frac{\partial\Phi}{\partial\phi} \Big] \\
+ &amp;\frac{\partial}{\partial\phi}\Big[ \frac{\Sigma_P}{\sin^2\theta}\frac{\partial\Phi}{\partial\phi}+\frac{\Sigma_H}{\sin\theta\cos\theta}\frac{\partial\Phi}{\partial\theta} \Big] = j_\parallel R^2\cos\delta
\end{aligned}
\tag{23.3}\]</span></span></p>
<ul>
<li><p>Be careful about distinguishing <span class="math inline">\(E_\parallel\)</span> and <span class="math inline">\(j_\parallel\)</span>. <span class="math inline">\(E_\parallel = 0\)</span> from advection and Hall terms, but <span class="math inline">\(j_\parallel=\nabla\times\mathbf{B}\cdot\hat{b}/\mu_0\)</span> can be nonzero at the MHD inner boundary.</p></li>
<li><p>How important it is to use a more realistic conductance model? <span class="citation" data-cites="merkin2010">(<a href="#ref-merkin2010" role="doc-biblioref">Merkin and Lyon 2010</a>)</span> shows that different BCs may give &gt; 10% CPCP values, but I have no clue about the effect of a more complicated conductance.</p></li>
</ul>
</section>
</section>
<section id="ionosphere-modeling" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="ionosphere-modeling"><span class="header-section-number">23.3</span> Ionosphere Modeling</h2>
<ul>
<li>What equation set is the model solving? How is the model solving them? What is being neglected?</li>
<li>What species are included? How is the chemistry solved?</li>
<li>Parameterizations in things such as heating, cooling, viscosity, conduction, chemistry, diffusion, collision, absorption, ionization cross sections, reaction rates…</li>
<li>How are upper and lower boundaries treated? How is the pole or the open/closed field-line boundary treated?</li>
<li>How are electrodynamics considered? How is the aurora specified? How is the magnetospheric electric field imposed? Is ion precipitation considered?</li>
</ul>
<p>For an ionosphere, a magnetic field-aligned grid is often used. This is complicated by the non-orthogonal nature of the magnetic field coordinate system. Assumptions are made.</p>
<p>How to solve each direction (coupled or independently)? For the ionosphere, along the field-line is treated differently than across the field-lines.</p>
<p>As the equations of motion are solved for, the source terms must be added. How to treat these with respect to solving in the different directions?</p>
<p>Build a simple 1D ionosphere model is easy (CAN I MAKE ONE MYSELF?).</p>
<p>Steady-state - assume <span class="math inline">\(\partial \mathbf{X}/\partial t = 0\)</span>. Strangly, this is applied in situations in which the value can change on a time scale much faster than the time-step. For example, the ion velocity is often assumed to be steady-state. Ion chemistry is sometimes assumed to be steady-state.</p>
<section id="chemistry" class="level3" data-number="23.3.1">
<h3 data-number="23.3.1" class="anchored" data-anchor-id="chemistry"><span class="header-section-number">23.3.1</span> Chemistry</h3>
<p><span class="math display">\[
\frac{\partial N}{\partial t} = S - L
\]</span> where <span class="math inline">\(N\)</span> is the number density of the species, <span class="math inline">\(S\)</span> represents the sources and <span class="math inline">\(L\)</span> represents the losses. Losses can almost always be expressed as: <span class="math display">\[
L = RMN
\]</span> where <span class="math inline">\(R\)</span> is the reaction rate, <span class="math inline">\(M\)</span> is the density of the species it is reacting with.</p>
<p>For a steady-state, <span class="math display">\[
\begin{aligned}
S - L &amp;= 0 \\
N &amp;= \frac{S}{RM}
\end{aligned}
\]</span></p>
<p>This is quite stable, but can be very wrong in regions of slowly changing ion densities, such as in the F-region. This is perfect for the E-region, though. It is quite easy to implement in a simple environment, but can be much more complicated as non-linear terms are include (recombination, in which <span class="math inline">\(M\)</span> can depend on <span class="math inline">\(N\)</span>).</p>
<p>An explicit time step chemistry is trivial to implement in almost all situations, but it is also the least stable, since the loss terms can become larger than the source terms and the density can quickly be driven to negative values. Subcycling can help with this, but not always.</p>
<p>An implicit time step chemistry is relatively stable and easier to implement than steady-state. For example in GITM, there is a blend between sub-cycling and a simplified implicit scheme that switches depending on the size of the loss term compared to the density.</p>
<p>Now we need to also look at the source terms. The ionization rates can be obtained from <span class="math inline">\(Q_\text{EUV}\)</span> and substituting <span class="math inline">\(\sigma_s^i \lambda\)</span> instead of <span class="math inline">\(\sigma_s^a\lambda\)</span> (not in <span class="math inline">\(\tau\)</span>). [Schunk and Nagy] Chapter 8 list a bunch of chemical equations.</p>
<p>After that, we write down all the sources and losses, decide a time-stepping scheme, and run the model. However, if we don’t have any ion advection, the F-region will just build and build!</p>
</section>
<section id="ion-advection" class="level3" data-number="23.3.2">
<h3 data-number="23.3.2" class="anchored" data-anchor-id="ion-advection"><span class="header-section-number">23.3.2</span> Ion Advection</h3>
<p>In the simplest form, we assume an advection speed and let the densities advect upward and downward.</p>
</section>
</section>
<section id="ionosphere-waveguide" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="ionosphere-waveguide"><span class="header-section-number">23.4</span> Ionosphere Waveguide</h2>
<p>The ionosphere waveguide refers to the phenomenon in which certain radio waves can propagate in the space between the ground and the boundary of the ionosphere. Because the ionosphere contains charged particles, it can behave as a conductor. The planet operates as a ground plane, and the resulting cavity behaves as a large waveguide. This is closely related to the concept of skin depth in EM and the cutoff in wave propagation.</p>
<p>At Earth, extremely low frequency (ELF) (&lt; 3 kHz) and very low frequency (VLF) (3–30 kHz) signals can propagate efficiently in this waveguide. For instance, lightning strikes launch a signal called radio atmospherics, which can travel many thousands of kilometers, because they are confined between the Earth and the ionosphere. The round-the-world nature of the waveguide produces resonances, like a cavity, which are at <span class="math inline">\(\sim 7\)</span> Hz.</p>
<p>A brief introduction can be found on <a href="https://en.wikipedia.org/wiki/Earth%E2%80%93ionosphere_waveguide">wiki</a>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-merkin2010" class="csl-entry" role="listitem">
Merkin, VG, and JG Lyon. 2010. <span>“Effects of the Low-Latitude Ionospheric Boundary Condition on the Global Magnetosphere.”</span> <em>Journal of Geophysical Research: Space Physics</em> 115 (A10). <a href="https://doi.org/10.1029/2010JA015461">https://doi.org/10.1029/2010JA015461</a>.
</div>
<div id="ref-raeder1995" class="csl-entry" role="listitem">
Raeder, J, RJ Walker, and M Ashour-Abdalla. 1995. <span>“The Structure of the Distant Geomagnetic Tail During Long Periods of Northward IMF.”</span> <em>Geophysical Research Letters</em> 22 (4): 349–52. <a href="https://doi.org/10.1029/94GL03380">https://doi.org/10.1029/94GL03380</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Region 1 &amp; 2 currents are currents in the magnetosphere, not ionosphere.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../contents/magnetosphere.html" class="pagination-link" aria-label="Magnetosphere">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Magnetosphere</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../contents/radiationbelt.html" class="pagination-link" aria-label="Radiation Belt">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Radiation Belt</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/henry2004y/KeyNotes/edit/master/contents/ionosphere.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>