<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>27&nbsp; Cosmic Ray – Key Notes in Plasma Physics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../contents/boundary.html" rel="next">
<link href="../contents/gc.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-a34d670291f06f286357e447776a572a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-eeb65414527888753efd28190bdf447d.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../contents/cr.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Cosmic Ray</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Key Notes in Plasma Physics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/henry2004y/KeyNotes/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Math</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/theoretical_mechanics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Theoretical Mechanics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/relativity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Relativity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/unit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Unit Conversion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/single.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Single-Particle Motions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/fluid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Plasmas as Fluid</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/diffres.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Diffusion and Resisvity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/wave.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Waves</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/emhd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">EMHD</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/kinetic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Kinetic Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/stability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Stability</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/kmhd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Kinetic MHD</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/gyrokinetics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Gyrokinetics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/flr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Field Line Resonance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Nonlinear Effects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/turbulence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Turbulence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/geometry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Geometry</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/solarwind.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Solar Wind</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/shock.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Shock</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/magnetosphere.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Magnetosphere</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/ionosphere.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Ionosphere</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/radiationbelt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Radiation Belt</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/aurora.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Aurora</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/gc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Guiding Center</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/cr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Cosmic Ray</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Boundary Conditions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/pic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Particle-in-Cell</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/hybrid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Hybrid Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/raytracing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Ray Tracing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/inductance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Inductance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/capacitance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Capacitance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#quasilinear-theory" id="toc-quasilinear-theory" class="nav-link active" data-scroll-target="#quasilinear-theory"><span class="header-section-number">27.1</span> Quasilinear Theory</a>
  <ul class="collapse">
  <li><a href="#sec-fokker-planck" id="toc-sec-fokker-planck" class="nav-link" data-scroll-target="#sec-fokker-planck"><span class="header-section-number">27.1.1</span> Derivation of the Fokker-Planck equation</a></li>
  <li><a href="#the-diffusion-approximation" id="toc-the-diffusion-approximation" class="nav-link" data-scroll-target="#the-diffusion-approximation"><span class="header-section-number">27.1.2</span> The diffusion approximation</a></li>
  <li><a href="#computation-of-transport-coefficients" id="toc-computation-of-transport-coefficients" class="nav-link" data-scroll-target="#computation-of-transport-coefficients"><span class="header-section-number">27.1.3</span> Computation of transport coefficients</a></li>
  <li><a href="#turbulence-geometries-and-spectra" id="toc-turbulence-geometries-and-spectra" class="nav-link" data-scroll-target="#turbulence-geometries-and-spectra"><span class="header-section-number">27.1.4</span> Turbulence geometries and spectra</a></li>
  <li><a href="#field-line-random-walk" id="toc-field-line-random-walk" class="nav-link" data-scroll-target="#field-line-random-walk"><span class="header-section-number">27.1.5</span> Field-line random walk</a></li>
  <li><a href="#short-comings-of-qlt" id="toc-short-comings-of-qlt" class="nav-link" data-scroll-target="#short-comings-of-qlt"><span class="header-section-number">27.1.6</span> Short-comings of QLT</a></li>
  </ul></li>
  <li><a href="#test-particle-simulation" id="toc-test-particle-simulation" class="nav-link" data-scroll-target="#test-particle-simulation"><span class="header-section-number">27.2</span> Test Particle Simulation</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/henry2004y/KeyNotes/edit/master/contents/cr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-cosmic-ray" class="quarto-section-identifier"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Cosmic Ray</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Cosmic rays (CRs), that is the population of charged, relativistic particles with non-thermal spectra, are ubiquitous in the Universe. They pervade systems of all sizes, from stellar systems to whole galaxies, from galaxy clusters to the intercluster medium. Modelling of cosmic ray transport and interpretation of cosmic ray data ultimately rely on a solid understanding of the interactions of charged particles with turbulent magnetic fields.</p>
<p><span class="citation" data-cites="mertsch2020test">Mertsch (<a href="#ref-mertsch2020test" role="doc-biblioref">2020</a>)</span> presents a thorough guide of performing test particle simulation for cosmic rays.</p>
<section id="quasilinear-theory" class="level2" data-number="27.1">
<h2 data-number="27.1" class="anchored" data-anchor-id="quasilinear-theory"><span class="header-section-number">27.1</span> Quasilinear Theory</h2>
<p>More than 50 years since its inception, <em>quasi-linear theory (QLT)</em> [<span class="citation" data-cites="jokipii1966cosmic">Jokipii (<a href="#ref-jokipii1966cosmic" role="doc-biblioref">1966</a>)</span>; Kennel and Engelmann 1966; Hall and Sturrock 1967; Hasselmann and Wibberenz 1970] is still very much the paradigm for phenomenological applications to Galactic cosmic rays. In QLT, the Fokker-Planck equation for the temporal evolution of the phase space density of CRs is derived in a perturbative approach where the force on a particle due to a turbulent magnetic field is evaluated along the unperturbed trajectory in a regular background field. The Fokker-Planck coefficients, most prominently the components of the spatial diffusion tensor, can be computed for a given model of turbulence, parametrised by the two-point function of the turbulent magnetic field. Famously, in QLT the interactions between plasma waves and particles are found to be resonant, meaning that particles of a certain gyroradius <span class="math inline">\(r_L = v/\Omega\)</span>, <span class="math inline">\(\Omega\)</span> denoting the gyrofrequency, are only affected by waves with a wavenumber k that satisfies <span class="math inline">\(k r_L \mu \approx 1\)</span> (for low-frequency waves like Alfvén waves), where <span class="math inline">\(\mu\)</span> is the cosine of the pitch-angle, that is the angle between the particle momentum <span class="math inline">\(\mathbf{p}\)</span> and the regular magnetic field <span class="math inline">\(\left&lt;\mathbf{B}\right&gt;\)</span>, <span class="math inline">\(\mu \equiv \mathbf{p}\cdot\left&lt; \mathbf{B} \right&gt; / (|\mathbf{p}||\left&lt; \mathbf{B} \right&gt;|)\)</span>.</p>
<p>While some of QLT’s predictions are qualitatively confirmed by data, e.g.&nbsp;the rigidity-dependence of the diffusion coefficients, there are a number of concerns. The most famous one is the <span class="math inline">\(90^\circ\)</span> problem: Due to the resonance condition, particles with pitch-angle close to <span class="math inline">\(90^\circ\)</span> (<span class="math inline">\(\mu\approx 0\)</span>) can only be in resonance with very large wavenumbers k which for the usual turbulent spectra contain little energy. In the limit <span class="math inline">\(\mu\rightarrow 0\)</span>, the scattering rate vanishes and particles cannot change direction along the background field resulting in <em>ballistic</em> transport. This is obviously at variance with the diffusive transport inferred from observations.</p>
<p>The root cause of the <span class="math inline">\(90^\circ\)</span> problem is the assumption of unperturbed trajectories in QLT. This is remedied in non-linear theories, where the decay of correlations leads to a broadening of the resonance condition which allows for efficient enough scattering through <span class="math inline">\(90^\circ\)</span>. However, any such extension of QLT requires additional assumptions, for instance on the form of temporal decorrelation of the particle’s trajectory.</p>
<p>The success and popularity of QLT can be ascribed to its conceptual simplicity and validity in a number of important environments, including the solar wind, the interstellar medium and galaxy clusters. In addition, QLT is simple in principle and thus allows for a straight-forward computation of the transport parameters, albeit it can become arbitrarily complex in practice. Finally, these results can be found to agree with inferences from observations, e.g.&nbsp;the normalisation and power law shape of the Galactic diffusion coefficient.</p>
<section id="sec-fokker-planck" class="level3" data-number="27.1.1">
<h3 data-number="27.1.1" class="anchored" data-anchor-id="sec-fokker-planck"><span class="header-section-number">27.1.1</span> Derivation of the Fokker-Planck equation</h3>
<p>For self-consistency, I will repeat all the equations here instead of linking to other parts of the note. Philipp Mertsch uses CGS unit in the following equations.</p>
<p>Charged particles in electric and magnetic fields <span class="math inline">\(\mathbf{E}\)</span> and <span class="math inline">\(\mathbf{B}\)</span> are subject to the Lorentz force, <span id="eq-lorentz-force-cgs"><span class="math display">\[
\mathbf{F}_L = e\left( \mathbf{E} + \mathbf{v}\times\mathbf{B}/c \right)
\tag{27.1}\]</span></span></p>
<p>It is customary to decompose the magnetic field into a large-scale, homogeneous, regular background field, <span class="math inline">\(\langle \mathbf{B} \rangle\)</span> and a small-scale, turbulent, random field <span class="math inline">\(\delta\mathbf{B}\)</span>, that is <span class="math inline">\(\mathbf{B} = \langle\mathbf{B}\rangle\)</span> with <span class="math inline">\(\langle\delta\mathbf{B}\rangle = 0\)</span>. The angled brackets denote averages over an ensemble of turbulent magnetic fields.</p>
<p>Without loss of generality, we assume in the following that the regular field is oriented along the z-direction, <span class="math inline">\(\langle\mathbf{B}\rangle = B_z\hat{z}\)</span>, unless stated otherwise. Large-scale electric fields are usually ignored, <span class="math inline">\(\langle\mathbf{E}\rangle = 0\)</span>, as the large mobility of charges in astrophysical plasmas is efficiently shielding against regular electric fields (that is on scales much larger than the Debye length). Small-scale electric fields <span class="math inline">\(\delta\mathbf{E}\)</span> are necessarily present, but from Faraday’s induction law, their magnitude can be estimated to be <span class="math inline">\(|\delta\mathbf{E}| \sim ( v_{\text{A}} / c) |\delta\mathbf{B}|\)</span> with <span class="math inline">\(v_\text{A}\)</span> the Alfvén velocity and <span class="math inline">\(v_A/c \ll 1\)</span> in most astrophysical environments.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Thus, to lowest order in <span class="math inline">\((v_\text{A}/c)\)</span>, there is no electric field and as the magnetic force is not performing any work on the particle, particle energy is consequently conserved. Note that at higher orders in <span class="math inline">\((v_\text{A}/c)\)</span>, the particle energy can change in a second-order Fermi type process. For simplicity, we constrain ourselves here to considering the lowest order case which results in pitch-angle scattering.</p>
<p>A charged particle in a magnetic field forms a Hamiltonian system as long as dissipative processes (or any form of energy losses) can be ignored. A consequence of this is <em>Liouville’s theorem</em>, that is the conservation of phase space volume under canonical transformations. As time evolution is a canonical transformation, phases space volume is conserved in time. Together with particle number conservation this implies the conservation of phase space density <span class="math inline">\(f = f(\mathbf{r},\mathbf{p},t)\)</span>. This is conveniently captured by what we will call <em>Liouville’s equation</em>, <span id="eq-liouville"><span class="math display">\[
\frac{\mathrm{d}f}{\mathrm{d}t} = \frac{\partial f}{\partial t} + \frac{\mathrm{d}\mathbf{r}}{\mathrm{d}t} \cdot \mathbf{\nabla}_{\mathbf{r}} f + \frac{\mathrm{d}\mathbf{p}}{\mathrm{d}t} \cdot \mathbf{\nabla}_{\mathbf{p}} f = 0
\tag{27.2}\]</span></span> encoding the incompressibility of the phase space flow. Here, <span id="eq-charge-particle-motion"><span class="math display">\[
\frac{\mathrm{d}\mathbf{r}}{\mathrm{d}t} = \mathbf{v},\quad \frac{\mathrm{d}\mathbf{p}}{\mathrm{d}t} = e\left( \mathbf{E} + \frac{\mathbf{v}\times\mathbf{B}}{c} \right)
\tag{27.3}\]</span></span> are the equations of motion. Note that a necessary condition for a Hamiltonian system is that the forces are conservative and differentiable (“p-divergence-free”, see more in <span class="citation" data-cites="bellan2008fundamentals">(<a href="#ref-bellan2008fundamentals" role="doc-biblioref">Bellan 2008</a>)</span>).</p>
<p>A collisionless plasma under the influence of external <span class="math inline">\(\mathbf{E}\)</span> and <span class="math inline">\(\mathbf{B}\)</span> fields is an example of a Hamiltonian system. Its Hamiltonian is (Jackson 1998) <span id="eq-charge-particle-hamiltonian"><span class="math display">\[
H = \sqrt{(c\mathbf{P} - e\mathbf{A})^2 + m^2c^4} + e\phi
\tag{27.4}\]</span></span> where <span class="math inline">\(\mathbf{P} = \mathbf{p} + (e/c)\mathbf{A}\)</span> is the canonical momentum, <span class="math inline">\(\mathbf{A}\)</span> the potential vector, m the particle mass, e its charge and <span class="math inline">\(\phi\)</span> the electric potential. Therefore, the phase space density of this collisionless plasma satisfies <a href="#eq-liouville" class="quarto-xref">Equation&nbsp;<span>27.2</span></a> and substituting the Lorentz force, <a href="#eq-lorentz-force-cgs" class="quarto-xref">Equation&nbsp;<span>27.1</span></a>, in <a href="#eq-liouville" class="quarto-xref">Equation&nbsp;<span>27.2</span></a> gives the Vlasov equation, <span id="eq-vlasov-cgs"><span class="math display">\[
\frac{\partial f}{\partial t} + \frac{\mathrm{d} \mathbf{r}}{\mathrm{d} t} \cdot \mathbf{\nabla}_{\mathbf{r}} f + e \left ( \mathbf{E} + \frac{\mathbf{v} \times \mathbf{B}}{c} \right ) \cdot \mathbf{\nabla}_{\mathbf{p}} f = 0
\tag{27.5}\]</span></span> which together with Maxwell’s equations forms the basis of plasma kinetic theory. For a collisional plasma, a term needs to be added to the right-hand side, the famous collision operator. For a collisionless plasma (as appropriate for CRs) the right-hand side remains zero.</p>
<p>Considering turbulent fields, the phase space density also becomes a random field, <span class="math inline">\(f = \langle f\rangle + \delta f\)</span>, with an expectation value, <span class="math inline">\(\langle f \rangle\)</span>, and fluctuations around it, <span class="math inline">\(\delta f\)</span>, that satisfy <span class="math inline">\(\langle \delta f \rangle=0\)</span>.</p>
<p>In any realistic astrophysical situation, it is of course impossible to know the small-scale turbulent field at all positions in order to exactly solve <a href="#eq-vlasov-cgs" class="quarto-xref">Equation&nbsp;<span>27.5</span></a>. Instead, one can only hope to predict statistical moments of the phase space density for a statistical ensemble of turbulent magnetic fields. Traditionally, one is mostly interested in the first moment, the ensemble average, while higher order moments is also possible to obtain.</p>
<p>For the reason explained above, we will ignore <span class="math inline">\(\mathbf{E}\)</span> in the following. Averaging <a href="#eq-vlasov-cgs" class="quarto-xref">Equation&nbsp;<span>27.5</span></a> we find (Jokipii 1972) <span id="eq-vlasov-averaged-cgs"><span class="math display">\[
\begin{aligned}
\frac{\mathrm{d} \langle f \rangle}{\mathrm{d} t} &amp;= \frac{\partial \langle f \rangle }{\partial t} + \frac{\mathrm{d}\mathbf{r}}{\mathrm{d}t} \cdot \mathbf{\nabla}_{\mathbf{r}} \langle f \rangle + e \frac{\mathbf{v} \times \langle \mathbf {B} \rangle}{c} \cdot \mathbf{\nabla}_{\mathbf{p}} \langle f \rangle \\
&amp;= - \left \langle e \frac{\mathbf{v} \times \mathbf{\delta B}}{c} \cdot \nabla _{\mathbf{p}} \delta f \right \rangle \neq 0
\end{aligned}
\tag{27.6}\]</span></span></p>
<p>Note that unlike the phase space density <span class="math inline">\(f\)</span>, the ensemble averaged phase space density <span class="math inline">\(\langle f \rangle\)</span> is not conserved, <span class="math inline">\(\mathrm{d}\langle f\rangle /\mathrm{d}t \neq 0\)</span>. (More on this later!)</p>
<p>One way to glean some physical insight from <a href="#eq-vlasov-averaged-cgs" class="quarto-xref">Equation&nbsp;<span>27.6</span></a> is to identify its right-hand-side with a damping term, (Earl+ 1988; Webb 1989), <span class="math display">\[
\left \langle e \frac{\mathbf{v} \times \mathbf{\delta B}}{c} \cdot \nabla_{\mathbf{p}} \delta f \right \rangle \to \nu \left( \langle f \rangle - \frac{1}{4\pi}\int\mathrm{d}\hat{\mathbf{p}} \, \langle f \rangle \right)
\]</span> (where <span class="math inline">\(\hat{\mathbf{p}}=\mathbf{p}/|\mathbf{p}|\)</span>), that is driving the phase space density towards isotropy at a rate <span class="math inline">\(\nu\)</span>, an approach that can also be motivated by gas kinetic theory (Bhatnagar+ 1954). This way, <a href="#eq-vlasov-averaged-cgs" class="quarto-xref">Equation&nbsp;<span>27.6</span></a> can be solved and shown to lead to a spatial diffusion equation. The parallel diffusion coefficient can be identified as <span class="math inline">\(\kappa_\parallel = v^2 / (3\nu)\)</span> whereas the perpendicular diffusion coefficient satisfies <span class="math inline">\(\kappa_\perp / \kappa_\parallel = (1 + \Omega^2 / \nu^2)^{-1}\)</span>, a result referred to as the <em>classical scattering limit</em> (Gleeson 1969). Here, <span class="math inline">\(\Omega\)</span> is the particle’s gyrofrequency.</p>
<p>In QLT, however, a more systematic solution for <span class="math inline">\(f\)</span> is sought through an equation for the temporal evolution of the fluctuations <span class="math inline">\(\delta f\)</span>. Such an equation can be obtained by subtracting the ensemble-averaged Vlasov <a href="#eq-vlasov-averaged-cgs" class="quarto-xref">Equation&nbsp;<span>27.6</span></a> from the original Vlasov <a href="#eq-vlasov-cgs" class="quarto-xref">Equation&nbsp;<span>27.5</span></a>, <span id="eq-vlasov-fluctuation-cgs"><span class="math display">\[
\begin{aligned}
&amp; \frac{\partial \delta f}{\partial t} + \frac{\mathrm{d}\mathbf{r}}{\mathrm{d}t} \cdot \mathbf{\nabla}_{\mathbf{r}} \delta f + e \left(\frac{\mathbf{v} \times \langle \mathbf{B}\rangle}{c}\right) \cdot \mathbf{\nabla}_{\mathbf{p}} \delta f \\
&amp; \simeq -e \left(\frac{\mathbf{v} \times \mathbf{\delta B}}{c} \right) \cdot \mathbf{\nabla}_{\mathbf{p}} \langle f \rangle
\end{aligned}
\tag{27.7}\]</span></span> Here, we have chosen to ignore the difference <span class="math display">\[
e \frac{\mathbf{v} \times \mathbf{\delta B}}{c} \cdot \nabla_{\mathbf{p}} \delta f - \left \langle e \frac{\mathbf{v} \times \mathbf{\delta B}}{c} \cdot \nabla_{\mathbf{p}} \delta f \right \rangle
\]</span> which is second order in perturbed quantities, <span class="math inline">\(\delta\mathbf{B}\)</span> and <span class="math inline">\(\delta f\)</span>. This assumes, of course, that <span class="math inline">\(|\delta\mathbf{B}|\ll |\langle \mathbf{B} \rangle|\)</span> and therefore <span class="math inline">\(\delta f \ll \langle f \rangle\)</span>. <a href="#eq-vlasov-fluctuation-cgs" class="quarto-xref">Equation&nbsp;<span>27.7</span></a> can now be integrated with the method of characteristics, the formal solution being <span id="eq-f-fluctuation-solution"><span class="math display">\[
\delta f = \delta f_{0} - \int _{t_{0}}^{t} \mathrm {d} t' \left[ e \left( \frac{\mathbf{v} \times \mathbf{\delta B}}{c} \right) \cdot \mathbf{\nabla}_{\mathbf{p}} \langle f \rangle \right]_{P(t')}
\tag{27.8}\]</span></span> Here, <span class="math inline">\(\delta f_{0} \equiv \delta f(\mathbf{r}, \mathbf{p}, t_{0})\)</span> denotes the phase space density at time <span class="math inline">\(t_0\)</span> and the subscript <span class="math inline">\(P(t')\)</span> indicates that positions and momenta in the square brackets are to be evaluated along the characteristics of <a href="#eq-vlasov-fluctuation-cgs" class="quarto-xref">Equation&nbsp;<span>27.7</span></a>, that is the solutions of the equations of motions, <a href="#eq-charge-particle-motion" class="quarto-xref">Equation&nbsp;<span>27.3</span></a> with <span class="math inline">\(\mathbf{B}\)</span> replaced by the regular field <span class="math inline">\(\langle\mathbf{B}\rangle\)</span> only (and again no electric field). These solutions <span class="math inline">\(P\)</span> are commonly referred to as <em>unperturbed orbits</em> or <em>unperturbed trajectories</em>. For the homogeneous regular magnetic field <span class="math inline">\(\langle\mathbf{B}\rangle = B_z\hat{z}\)</span> assumed here they are of course helices along the z-direction.</p>
<p>We can now substitue <a href="#eq-f-fluctuation-solution" class="quarto-xref">Equation&nbsp;<span>27.8</span></a> into <a href="#eq-vlasov-averaged-cgs" class="quarto-xref">Equation&nbsp;<span>27.6</span></a>, <span id="eq-vlasov-averaged-cgs2"><span class="math display">\[
\begin{aligned}
&amp; \frac{\partial \langle f \rangle }{\partial t} + \frac{\mathrm{d}\mathbf{r}}{\mathrm{d}t} \cdot \mathbf{\nabla}_{\mathbf{r}} \langle f \rangle + e \frac{\mathbf{v} \times \langle \mathbf {B} \rangle}{c} \cdot \mathbf{\nabla}_{\mathbf{p}} \langle f \rangle \\
&amp;\simeq \int _{t_{0}}^{t} \!\! \mathrm {d} t' \! \left \langle e \frac{\mathbf{v} \! \times \! \mathbf{\delta B}}{c} \! \cdot \! \nabla _{\mathbf{p}} \left [ e \frac{\mathbf{v} \! \times \! \mathbf{\delta B}}{c} \! \cdot \! \mathbf{\nabla}_{\mathbf{p}} \langle f \rangle \right ]_{P(t')} \right \rangle
\end{aligned}
\tag{27.9}\]</span></span> where we have dropped the term <span class="math inline">\(\propto \delta f_0\)</span>. At this stage, we can already see that the right-hand side will lead to diffusion terms (courtesy of the two momentum derivatives) and that it depends on the turbulent magnetic field’s two-point function, integrated along the unperturbed trajectory <span class="math inline">\(P(t')\)</span>. To make further progress, we consider the momentum <span class="math inline">\(\mathbf{p}\)</span> in spherical coordinates, that is <span class="math inline">\(\mathbf{p} = p\left( \sqrt{1-\mu^2}\cos\phi, \sqrt{1-\mu^2}\sin\phi, \mu \right)^T\)</span> and introduce the correlation lengths <span class="math inline">\(l_c\)</span> and correlation times <span class="math inline">\(\tau_c\)</span> of the turbulent magnetic field, defined through<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> <span id="eq-turbulence-correlation-length"><span class="math display">\[
\langle \delta B^{2} \rangle l_{\text{c}} \equiv \int _{0}^{\infty} \mathrm {d} \Delta r \, \langle \delta B(\mathbf{r}) \delta B(\mathbf{r}+\mathbf{\Delta r}) \rangle
\tag{27.10}\]</span></span> <span id="eq-turbulence-correlation-time"><span class="math display">\[
\langle \delta B^{2} \rangle \tau_{\text{c}} \equiv \int _{0}^{\infty} \mathrm {d} \Delta t \, \langle \delta B(t) \delta B(t+\Delta t) \rangle
\tag{27.11}\]</span></span> Here, <span class="math inline">\(\delta B(t)\)</span> is short-hand for <span class="math inline">\(\left[\delta B(\mathbf{r}) \right]_{P(t)}\)</span>, that is <span class="math inline">\(\delta B(\mathbf{r})\)</span> evaluated along the unperturbed trajectory at time t.</p>
<p>The right-hand side of <a href="#eq-vlasov-averaged-cgs2" class="quarto-xref">Equation&nbsp;<span>27.9</span></a> is still rather unwieldy and further progress requires a number of assumptions. In addition to</p>
<ol type="1">
<li>Smallness of perturbations, <span class="math inline">\(|\mathbf{\delta B}| \ll |\langle \mathbf{B} \rangle|\)</span></li>
</ol>
<p>these are:</p>
<ol start="2" type="1">
<li><p>Gyrotropy: The ensemble-averaged phase space density <span class="math inline">\(\langle f \rangle\)</span> does not depend on the azimuthal angle <span class="math inline">\(\phi\)</span>, so <span class="math inline">\(\langle f \rangle (\mathbf{r}, p, \mu, \phi, t) \to \langle f \rangle (\mathbf{r}, p, \mu, t)\)</span>.</p></li>
<li><p>Adiabatic approximation: The phase space density only varies on time-scales much larger than the correlation time of the turbulent magnetic field, <span class="math inline">\(\tau_c\)</span>, <span id="eq-adiabatic-approx"><span class="math display">\[
\langle f \rangle \left / \frac{\partial \langle f \rangle }{\partial t} \right . \gg \tau _{\text{c}}
\tag{27.12}\]</span></span></p></li>
<li><p>Finite correlation times: The correlation times of the turbulent magnetic field are much larger than the Larmor time, <span class="math inline">\(\tau_c \gg \Omega^{-1}\)</span>.</p></li>
<li><p>Homogeneous and stationary turbulence: the statistical moments are invariant under translations in space and time. In natural language, it means that the statistics of turbulence do not depend on when and where to take measurements.</p></li>
</ol>
<p>Under these conditions, the ensemble averaged Vlasov equation ultimately results in a Fokker-Planck type equation (Fokker 1914; Planck 1917), also known as the Kolmogorov forward (Kolmogorov 1931) or as the Smoluchowski equation (Bogoliubov and Krylov 1939), describing diffusion in pitch-angle, <span id="eq-fokker-planck"><span class="math display">\[
\frac{\partial \langle f \rangle }{\partial t} + v \mu \frac{\partial \langle f \rangle }{\partial z} = \frac{\partial }{\partial \mu } \left ( D_{\mu \mu } \frac{\partial \langle f \rangle }{\partial \mu } \right ) \, .
\tag{27.13}\]</span></span></p>
<p>Following the approach sketched above, the pitch-angle diffusion coefficient, <span id="eq-pitch-angle-diffusion-coef"><span class="math display">\[
D_{\mu \mu} \equiv \frac{\langle (\Delta \mu )^{2} \rangle }{2 \Delta t}
\tag{27.14}\]</span></span> can be expressed in terms of the correlation function of the magnetic field. (HOW???)</p>
<p>If we had not decided to ignore any electric field, additional terms would have appeared in the Fokker-Planck <a href="#eq-fokker-planck" class="quarto-xref">Equation&nbsp;<span>27.13</span></a>, relating to changes in momentum <span class="math inline">\(\mathbf{p}\)</span> and pitch-angle, with diffusion coefficients <span class="math inline">\(D_{\mu p} = D_{p\mu}\)</span> and <span class="math inline">\(D_{pp}\)</span> defined analogously to <a href="#eq-pitch-angle-diffusion-coef" class="quarto-xref">Equation&nbsp;<span>27.14</span></a>.</p>
<p>We have furthermore assumed that <span class="math inline">\(v_A / v \ll 1\)</span> in order for <span class="math inline">\(D_{xx}, D_{yy}, D_{xy}\)</span> and <span class="math inline">\(D_{yx}\)</span> to be negligible. Not doing so, would have resulted in the additional terms <span class="math display">\[
\frac{\partial}{\partial x} \left (D_{xx} \frac{\partial \langle f \rangle }{\partial x} + D_{xy} \frac{\partial \langle f \rangle }{\partial y} \right ) + \frac{\partial}{\partial y} \left (D_{yx} \frac{\partial \langle f \rangle }{\partial x} + D_{yy} \frac{\partial \langle f \rangle }{\partial y} \right )
\]</span> to be added to the right-hand side of <a href="#eq-fokker-planck" class="quarto-xref">Equation&nbsp;<span>27.13</span></a>.</p>
<p>In summary, under the influence of a turbulent magnetic field, charged particles are performing a random walk in pitch-angle which in the ensemble average results in diffusion in pitch-angle (cosine).</p>
</section>
<section id="the-diffusion-approximation" class="level3" data-number="27.1.2">
<h3 data-number="27.1.2" class="anchored" data-anchor-id="the-diffusion-approximation"><span class="header-section-number">27.1.2</span> The diffusion approximation</h3>
<p>Particle transport can be conveniently categorised if the mean-square displacement in direction i, <span class="math inline">\(\langle \Delta x_i^2 \rangle\)</span>, has a power law dependence,<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> <span id="eq-diffusion-power-law"><span class="math display">\[
\langle \Delta {r}_{i}^{2} \rangle \propto (\Delta t)^{\alpha}
\tag{27.15}\]</span></span> as <span class="math display">\[
\begin{array}{r@{\quad } l}
\alpha &lt; 1: &amp; \text{sub-diffusive,} \\
\alpha = 1: &amp; \text{diffusive,} \\
\alpha &gt; 1:&amp; \text{super-diffusive, in particular} \\
\alpha = 2: &amp; \text{ballistic.}
\end{array}
\]</span></p>
<p>It seems clear that transport in any perturbative theory with <span class="math inline">\(|\mathbf{\delta B}| \ll |\langle \mathbf{B} \rangle|\)</span> must be ballistic at early enough times: Particles just gyrate around <span class="math inline">\(\langle\mathbf{B}\rangle\)</span> and <span class="math inline">\(\langle \Delta z^{2} \rangle = (v \mu \Delta t)^{2}\)</span> while <span class="math inline">\(\langle \Delta x^{2} \rangle = \langle \Delta y^{2} \rangle = 0\)</span> when integrated over full gyroperiods. At late times, that is for <span class="math inline">\(t \gg D_{\mu\mu}^{-1}\)</span>, we would expect diffusive behaviour for the transport along the field.</p>
<p>In order to formalise this picture, we derive a spatial diffusion equation from the Fokker-Planck <a href="#eq-fokker-planck" class="quarto-xref">Equation&nbsp;<span>27.13</span></a>. To this end, we decompose <span class="math inline">\(\langle f\rangle\)</span> into an isotropic part, <span class="math inline">\(g\)</span>, and an anisotropic part, <span class="math inline">\(h\)</span>, <span class="math display">\[
\langle f \rangle (p, \mu, t) = g(p, t) + h(p, \mu, t)
\]</span> where <span class="math display">\[
g(p, t) = \frac{1}{2}\int_{-1}^{1} \mathrm{d}\mu \langle f \rangle (p, \mu, t)
\]</span> and <span class="math display">\[
\int_{-1}^{1} \mathrm{d}\mu\, h(p, \mu, t) = 0
\]</span></p>
<p>If <span class="math inline">\(g\)</span> varies only slowly with time and position, <span class="math display">\[
g \left / \frac{\partial g}{\partial t} \right . \gg \tau_{\text{sc}} \quad \text{and} \quad g \left / \frac{\partial g}{\partial z} \right . \gg \lambda_{\text{sc}}
\]</span> where <span class="math inline">\(\tau_{\text{sc}} \sim D_{\mu \mu }^{-1}\)</span> and <span class="math inline">\(\lambda_{\text{sc}} \sim v \tau_{\text{sc}}\)</span> are the scattering time and mean-free path, respectively, the phase space density will be very isotropic, <span class="math inline">\(h\ll g\)</span>. In this case, we can derive a spatial diffusion equation for the isotropic part <span class="math inline">\(g\)</span> (e.g.&nbsp;Hasselmann and Wibberenz 1970), <span id="eq-isotropic-diffusion"><span class="math display">\[
\frac{\partial g}{\partial t} - \frac{\partial }{\partial z} \left( \kappa_{\parallel} \frac{\partial g}{\partial z} \right) = 0
\tag{27.16}\]</span></span> with the parallel diffusion coefficient <span id="eq-parallel-diffusion-coef"><span class="math display">\[
\kappa_{\parallel} = \frac{v^{2}}{8} \int_{-1}^{1} \mathrm{d} \mu \frac{(1- \ \mu^{2})^{2}}{D_{\mu\mu}}
\tag{27.17}\]</span></span></p>
<p>Furthermore, we would expect the anisotropic part <span class="math inline">\(h\)</span> to be dominated by the <em>dipole anisotropy</em> (???), that is <span class="math inline">\(h\approx h_1\mu\)</span> with <span id="eq-dipole-anisotropy"><span class="math display">\[
h_{1} = \frac{3}{2} \int_{-1}^{1} \mathrm{d} \mu \, \mu \, h(\mu) = - \frac{2}{v} \kappa_{\parallel} \frac{\partial g}{\partial z}
\tag{27.18}\]</span></span></p>
</section>
<section id="computation-of-transport-coefficients" class="level3" data-number="27.1.3">
<h3 data-number="27.1.3" class="anchored" data-anchor-id="computation-of-transport-coefficients"><span class="header-section-number">27.1.3</span> Computation of transport coefficients</h3>
<p>So far, we have not specified the functional form of the Fokker-Planck coefficients, e.g.&nbsp;the pitch-angle diffusion coefficient <span class="math inline">\(D_{\mu\mu}\)</span>, and its dependence on the two-point correlation function of turbulence <span class="math inline">\(P_{ij}(\mathbf{k})\)</span> that emerges in the derivation of the Fokker-Planck <a href="#eq-fokker-planck" class="quarto-xref">Equation&nbsp;<span>27.13</span></a>. An alternative to the derivation of <a href="#sec-fokker-planck" class="quarto-xref"><span>Section 27.1.1</span></a> is to directly compute the Fokker-Planck coefficients from solutions of the equations of motion. In fact, an arbitrary Fokker-Planck coefficient <span class="math inline">\(D_{PQ}\)</span> can be defined in terms of the mean displacements of the variables in question, P and Q. For instance, the pitch-angle diffusion coefficient can be derived as the <span class="math inline">\(t\to\infty\)</span> limit of the running diffusion coefficient, <span id="eq-running-diffusion-coef"><span class="math display">\[
d_{\mu\mu}(t) = \frac{1}{2} \frac{\mathrm{d}}{\mathrm{d}t}\left \langle (\Delta \mu )^{2} \right \rangle
\tag{27.19}\]</span></span></p>
<p>This is a consequence of the Taylor-Green-Kubo formula (Taylor 1922; Green 1951; Kubo 1957), <span id="eq-TGK"><span class="math display">\[
D_{\mu\mu} = \int_{0}^{\infty} \mathrm{d} t \langle \dot{\mu}(0) \dot{\mu}(t) \rangle
\tag{27.20}\]</span></span> where the dots denote derivatives with respect to time. For diffusive transport, <a href="#eq-pitch-angle-diffusion-coef" class="quarto-xref">Equation&nbsp;<span>27.14</span></a> and <a href="#eq-running-diffusion-coef" class="quarto-xref">Equation&nbsp;<span>27.19</span></a> coincide, of course. Moreover, this allows computing the parallel diffusion coefficient <span class="math inline">\(\kappa_\parallel\)</span> without the detour of computing <span class="math inline">\(D_{\mu\mu}\)</span> first and then applying the diffusion approximation, <a href="#eq-parallel-diffusion-coef" class="quarto-xref">Equation&nbsp;<span>27.17</span></a>.</p>
<p>From the equations of motion <a href="#eq-lorentz-force-cgs" class="quarto-xref">Equation&nbsp;<span>27.1</span></a>, we find (HOW???) <span id="eq-pitch-angle-cosine-time-derivative"><span class="math display">\[
\dot{\mu} = \frac{e}{c p} \left( \mathbf{v} \times \mathbf{B} \right)_{z} = \frac{1}{r_{\text{g}} B_z} \left(v_{x} \delta B_{x}(\mathbf{r}) - v_{y} \delta B_{y}(\mathbf{r}) \right)
\tag{27.21}\]</span></span> and thus <span id="eq-pitch-angle-coef"><span class="math display">\[
D_{\mu\mu} = \frac{1}{ B_{z} ^{2} r_{\text{g}}^{2}} \int_{0}^{\infty }\mathrm{d} t \left[ v_{x}(t) v_{x}(0) \mathcal{P}_{yy}(t) + v_{y}(t) v_{y}(0) \mathcal{P}_{xx}(t) \right]
\tag{27.22}\]</span></span></p>
<p>Here, we have defined <span id="eq-two-point-func"><span class="math display">\[
\mathcal{P}_{ij}(t) \equiv \langle \delta B_{i}(0) \delta B_{j}(t) \rangle
\tag{27.23}\]</span></span> and both the velocities and the magnetic fields are to be evaluated along unperturbed trajectories. Note that the fact that the Fokker-Planck coefficients only depend on the two-point function means that we can constrain ourselves to the Gaussian part of the turbulent magnetic field.</p>
</section>
<section id="turbulence-geometries-and-spectra" class="level3" data-number="27.1.4">
<h3 data-number="27.1.4" class="anchored" data-anchor-id="turbulence-geometries-and-spectra"><span class="header-section-number">27.1.4</span> Turbulence geometries and spectra</h3>
<p>To make further progress, we need to specify the turbulence correlation tensor <span class="math inline">\(\mathcal{P}_{ij}\)</span>. In the derivation of the Fokker-Planck equation we had to assume that turbulence is homogeneous and stationary (assumption 5). In this case, the field can be represented very economically in Fourier space. To this end, we introduce the Fourier transform pair <span id="eq-turbulence-B-fourier"><span class="math display">\[
\begin{aligned}
\delta \tilde{B}_{j}(\mathbf{k}, t) &amp;= (2\pi)^{-3/2} \int_{-\infty }^{\infty} \mathrm{d}^{3} r \, \delta B_{j}(\mathbf{r}, t) \mathrm{e} ^{\imath \mathbf{k} \cdot \mathbf{r}} \\
\delta B_{j}(\mathbf{x}, t) &amp;= (2\pi)^{-3/2} \int_{-\infty}^{\infty} \mathrm{d}^{3} k \, \delta \tilde{B}_{j}(\mathbf{k}, t) \mathrm{e} ^{-\imath \mathbf{k} \cdot \mathbf{r}}
\end{aligned}
\tag{27.24}\]</span></span></p>
<p>Note that for the magnetic field to have real values, <span class="math inline">\(\delta B_{j}(\mathbf{r}) = \delta B^{*}_{j}(\mathbf{r})\)</span>, requires a relation between the Fourier components and their complex conjugates, <span class="math display">\[
\delta \tilde{B}^{*}_{j}(\mathbf{k}) = \delta \tilde{B}_{j}(-\mathbf{k})
\]</span></p>
<p>The homogeneity and stationarity now guarantee that the two-point functions <span class="math inline">\(\langle \delta B_{i}(\mathbf{r}, t) \delta B_{j}(\mathbf{r}', t') \rangle\)</span> depend on the positions <span class="math inline">\(\mathbf{r}\)</span> and <span class="math inline">\(\mathbf{r}'\)</span> and times <span class="math inline">\(t\)</span> and <span class="math inline">\(t'\)</span> only through the differences <span class="math inline">\(\Delta \mathbf{r} \equiv (\mathbf{r} - \mathbf{r}')\)</span> and <span class="math inline">\((t-t')\)</span>. It is then easy to see that the two-point function in Fourier space is diagonal, <span class="math display">\[
\begin{aligned}
&amp; \langle \delta \tilde{B}_{i}(\mathbf{k}, t) \delta \tilde{B}^{*}_{j}(\mathbf{k}', t') \rangle \\ &amp;= \! (2 \pi )^{-3} \!\!\! \int \!\! \mathrm {d} ^{3} r \, \mathrm {e} ^{ \imath \mathbf{k} \cdot \mathbf{r}} \!\!\! \int \!\! \mathrm {d} ^{3} r' \mathrm {e} ^{-\imath \mathbf{k}' \cdot \mathbf{r}'} \!\! \langle \delta B_{i}(\mathbf{r}, t) \delta B_{j}(\mathbf{r}'\!, t') \rangle \\
&amp;= \delta ^{(3)} (\mathbf{k} - \mathbf{k}') P_{ij}(\mathbf{k}, t-t')
\end{aligned}
\]</span> where the turbulence correlation tensor <span class="math inline">\(P_{ij}(\mathbf{k}, \Delta t)\)</span> is the Fourier transform of the coordinate space two-point function <span id="eq-turbulence-correlation-tensor"><span class="math display">\[
\begin{aligned}
P_{ij}(\mathbf{k}, \Delta t) \equiv &amp; (2 \pi )^{-3/2} \int _{-\infty}^{\infty} \mathrm {d} ^{3} (\Delta r) \, \mathrm {e} ^{\imath \mathbf{k} \cdot \Delta \mathbf{r}} \\ &amp; \times \langle \delta B_{i}(\mathbf{r}, t) \delta B_{j}(\mathbf{r} - \Delta \mathbf{r}\!, t') \rangle
\end{aligned}
\tag{27.25}\]</span></span></p>
<p>It contains all the (statistical) information on the magnetic turbulence that enters into the computation of the Fokker-Planck coefficients:</p>
<ul>
<li>information on the turbulence geometry, for instance whether there is a preferred direction for the propagation of waves;</li>
<li>information on the turbulence spectrum, that is the distribution of energy among different turbulent scales;</li>
<li>information on the time-dependence of the correlations.</li>
</ul>
<p>Oftentimes, it is assumed that <span class="math inline">\(P_{ij}(\mathbf{k}, \Delta t)\)</span> factorises into a magnetostatic correlation tensor <span class="math inline">\(P_{ij}(\mathbf{k}) \equiv P_{ij}(\mathbf{k}, 0)\)</span> independent of time and a time-dependent dynamical correlation function <span class="math inline">\(\Gamma(\mathbf{k}, \Delta t)\)</span>, <span id="eq-turbulence-correlation-tensor-decomposition"><span class="math display">\[
P_{ij}(\mathbf{k}, \Delta t) = P_{ij}(\mathbf{k}) \Gamma (\mathbf{k}, \Delta t)
\tag{27.26}\]</span></span></p>
<p>In the magnetostatic approximation, we ignore any time-dependence altogether, so <span class="math display">\[
\Gamma \equiv 1
\]</span></p>
<p>While in reality <span class="math inline">\(P_{ij}\)</span> may be arbitrarily complicated, three turbulence geometries have dominated much of the literature, both in analytical studies of transport coefficients and numerical test particle simulations. These three geometries are conceptually simple and particularly amenable to analytical computations of the components of the diffusion tensor and the other Fokker-Planck coefficients:</p>
<ul>
<li>3D isotropic turbulence</li>
<li>slab turbulence</li>
<li>a composition of slab and 2D isotropic turbulence</li>
</ul>
<section id="d-isotropic-turbulence" class="level4" data-number="27.1.4.1">
<h4 data-number="27.1.4.1" class="anchored" data-anchor-id="d-isotropic-turbulence"><span class="header-section-number">27.1.4.1</span> 3D isotropic turbulence</h4>
<p>For 3D isotropic turbulence the magnetostatic correlation tensor takes the form (Batchelor 1982) <span id="eq-correlation-tensor-3disotropic"><span class="math display">\[
P^{\text{3D}}_{ij}(\mathbf{k}) = g^{\text{3D}}(k) \left( \delta _{ij} - \frac{k_{i} k_{j}}{k^{2}} + \imath \sigma(k) \epsilon_{ijm} \frac{k_{m}}{k} \right)
\tag{27.27}\]</span></span></p>
<p>The k-dependent real functions <span class="math inline">\(g^{\text{3D}}(k)\)</span> and <span class="math inline">\(\sigma(k)\)</span> allow modelling of the overall spectrum and of a wavenumber-dependent helicity, respectively. Note that for linearly polarised waves <span class="math inline">\(\sigma(k)\equiv 0\)</span>. The normalization of <span class="math inline">\(g^{\text{3D}}(k)\)</span> is fixed by requiring <span id="eq-isotropic-normalization"><span class="math display">\[
\begin{aligned}
\delta B^{2} &amp;\equiv \langle \mathbf{\delta B}^{2}(\mathbf{x}) \rangle \! = \!\! \int \mathrm {d} ^{3} k \left ( P^{\text{3D}}_{xx}(\mathbf{k}) + P^{\text{3D}}_{yy}( \mathbf{k}) + P^{\text{3D}}_{zz}(\mathbf{k}) \right ) \\ &amp;= 2 \int \mathrm {d} ^{3} k \, g^{\text{3D}}(k) = 8 \pi \int _{0}^{\infty } \mathrm {d} k \, k^{2} g^{\text{3D}}(k)
\end{aligned}
\tag{27.28}\]</span></span></p>
</section>
<section id="slab-turbulence" class="level4" data-number="27.1.4.2">
<h4 data-number="27.1.4.2" class="anchored" data-anchor-id="slab-turbulence"><span class="header-section-number">27.1.4.2</span> Slab turbulence</h4>
<p>In slab turbulence, it is assumed that all quantities are independent of the coordinates perpendicular to the background field (x and y) and that the turbulent field has no z-component. Consequently, the wave vectors <span class="math inline">\(\mathbf{k}\parallel \hat{z}\)</span> and if we further demand turbulence to be axisymmetric, the turbulence correlation tensor reads <span id="eq-correlation-tensor-slab"><span class="math display">\[
P^{\text{slab}}_{ij}(\mathbf{k}) = g^{\text{slab}}(k_{\parallel }) \frac{\delta (k_{\perp })}{k_{\perp }} \left ( \delta _{ij} + \imath \sigma (k_{\parallel }) \epsilon _{ijz} \right )
\tag{27.29}\]</span></span> for <span class="math inline">\(i, j \in x, y\)</span> and zero otherwise. In our case <span class="math inline">\(k_\parallel = k_z\)</span> and <span class="math inline">\(k_{\perp } = \sqrt{k_{x}^{2} + k_{y}^{2}}\)</span>. Again, <span class="math inline">\(\sigma(k_\parallel)\)</span> allows for wavenumber-dependent helicity, but vanishes for linear polarisation. The normalisation is then <span id="eq-slab-normalization"><span class="math display">\[
\begin{aligned}
\delta B^{2} &amp;\equiv \int \mathrm{d} ^{3} k \left( P^{\text{slab}}_{xx}( \mathbf{k}) + P^{\text{slab}}_{yy}(\mathbf{k}) \right) \\
&amp;= 4 \pi \int _{-\infty}^{\infty} \mathrm{d} k_{\parallel} \, g^{ \text{slab}}(k_{\parallel})
\end{aligned}
\tag{27.30}\]</span></span></p>
<p>While slab turbulence might seem rather restrictive a turbulence model, it is quite attractive due to its simplicity. In addition, it could be argued that it is of physical relevance in situations where the turbulence is self-generated by anisotropies in the distribution of CRs (Kulsrud and Pearce 1969; Skilling 1975): It has been shown (e.g.&nbsp;Tademaru 1969) that the modes with wavevectors along the background magnetic field grow fastest.</p>
</section>
<section id="composite-slab-2d-isotropic-turbulence" class="level4" data-number="27.1.4.3">
<h4 data-number="27.1.4.3" class="anchored" data-anchor-id="composite-slab-2d-isotropic-turbulence"><span class="header-section-number">27.1.4.3</span> Composite (slab + 2D isotropic) turbulence</h4>
</section>
<section id="turbulence-spectra" class="level4" data-number="27.1.4.4">
<h4 data-number="27.1.4.4" class="anchored" data-anchor-id="turbulence-spectra"><span class="header-section-number">27.1.4.4</span> Turbulence spectra</h4>
<p>Having reviewed three simple turbulence geometries, we need to specify the spectral shapes <span class="math inline">\(g(k)\)</span> in order to compute transport coefficients. In cascade models of turbulence, energy is injected on the largest scales in the so-called <em>injection (energy) range</em>. Non-linear interactions transfer energy to smaller scales over the so-called <em>inertial range</em>. At very small scales, the turbulent energy is dissipated in the so-called <em>dissipation range</em>. The scale separating the injection and inertial ranges is called the <em>outer scale of turbulence</em> and the scale separating the inertial and the dissipation range is called the <em>dissipation scale</em>.</p>
<p>Most studies deal with one of two spectra. The first one is a simple power law with spectral index <span class="math inline">\(q\)</span> and low wavenumber cut-off <span class="math inline">\(k_0\)</span>, corresponding to the outer scale <span class="math inline">\((2\pi/k_0)\)</span>, <span class="math display">\[
g_{\text{PL}}(k) = \left \{ \textstyle\begin{array}{l@{\quad }l} g_{0} (k/k_{0})^{-q} &amp; \text{for } k \geq k_{0} \, , \\ 0 &amp; \text{otherwise.} \end{array}\displaystyle \right .
\]</span></p>
<p>The alternative is a broken power law with a flat spectrum below the wavenumber <span class="math inline">\(k_0\)</span> and a power law slope <span class="math inline">\(q\)</span> above, <span class="math display">\[
g_{\text{BPL}}(k) = g_{0} \left ( 1 + \left ( \frac{k}{k_{0}} \right )^{1/s} \right )^{-q s} \, .
\]</span> Here, <span class="math inline">\(s\)</span> is parametrising the softness of the break and <span class="math inline">\(s\to 0\)</span> corresponds to a sharp break. It is assumed that the broken power law form can potentially also capture turbulence in the injection range, that is for <span class="math inline">\(k&lt;k_0\)</span>.</p>
</section>
<section id="slab-turbulence-with-broken-power-law-spectrum" class="level4" data-number="27.1.4.5">
<h4 data-number="27.1.4.5" class="anchored" data-anchor-id="slab-turbulence-with-broken-power-law-spectrum"><span class="header-section-number">27.1.4.5</span> Slab turbulence with broken power law spectrum</h4>
<p>The result for the pitch-angle diffusion coefficient in slab turbulence and for the broken power law spectrum (Shalchi 2009) is given as an example. <span id="eq-g-slab-turbulence"><span class="math display">\[
g^{\text{slab}}(k_{\parallel }) = \frac{C \left (q, \frac{1}{2} \right )}{2 \pi k_{0}} \delta B^{2} \left ( 1 + \left ( \frac{k}{k_{0}} \right )^{2} \right )^{-q/2} \, .
\tag{27.31}\]</span></span></p>
<p>The function <span class="math inline">\(C(q, s)\)</span> is fixed by the normalisation condition, see <a href="#eq-slab-normalization" class="quarto-xref">Equation&nbsp;<span>27.30</span></a>, <span id="eq-slab-normalization2"><span class="math display">\[
\begin{aligned}
\frac{1}{C(q, s)} &amp; \equiv \frac{4}{k_{0}} \int_{0}^{\infty} \mathrm {d} k \, \left ( 1 + \left( \frac{k}{k_{0}} \right )^{1/s} \right)^{-q s} \\
&amp;= \frac{4}{k_{0}} \frac{\Gamma (s(q-1)) \Gamma (1+s)}{\Gamma (q \, s)}
\end{aligned}
\tag{27.32}\]</span></span></p>
<p>where <span class="math inline">\(\Gamma (\cdot)\)</span> denotes the gamma function. We have assumed that <span class="math inline">\(q&gt;1\)</span> in order for the k-integral in <a href="#eq-slab-normalization2" class="quarto-xref">Equation&nbsp;<span>27.32</span></a> to converge. For <span class="math inline">\(q=1\)</span>, instead, we need to assume a cut-off, that is <span class="math inline">\(g^{\text{slab}} = 0\)</span> for <span class="math inline">\(k_{\parallel} &gt; k_{\text{max}}\)</span>.</p>
<p>Substituting <a href="#eq-g-slab-turbulence" class="quarto-xref">Equation&nbsp;<span>27.31</span></a> into <a href="#eq-correlation-tensor-slab" class="quarto-xref">Equation&nbsp;<span>27.29</span></a> and <a href="#eq-pitch-angle-coef" class="quarto-xref">Equation&nbsp;<span>27.22</span></a>, one encounters the resonance function (Schlickeiser 2002) <span id="eq-slab-turbulence-resonance"><span class="math display">\[
R^{\text{slab}} = \pi \delta (k_{\parallel } \mu v \pm \Omega )
\tag{27.33}\]</span></span></p>
<p>Eventually, this simplifies to <span id="eq-diffusion-coef-slab-turbulence"><span class="math display">\[
D_{\mu \mu } = \frac{\pi }{2} C \! \left ( \! q, \frac{1}{2} \! \right ) q k_{0} \frac{\delta B^{2}}{B_{z}^{2}} \frac{(1 - \mu ^{2}) \mu ^{q-1} (r_{\text{L}} k_{0})^{q-2}}{(1 + \mu ^{2} (r_{\text{L}} k_{0}))^{q/2}}
\tag{27.34}\]</span></span></p>
</section>
</section>
<section id="field-line-random-walk" class="level3" data-number="27.1.5">
<h3 data-number="27.1.5" class="anchored" data-anchor-id="field-line-random-walk"><span class="header-section-number">27.1.5</span> Field-line random walk</h3>
<p>The computation of the pitch-angle diffusion coefficient in <a href="#eq-TGK" class="quarto-xref">Equation&nbsp;<span>27.20</span></a> and <a href="#eq-pitch-angle-coef" class="quarto-xref">Equation&nbsp;<span>27.22</span></a> is based on an evaluation of the turbulent part of the Lorentz force along trajectories around the homogeneous background field. As long as perturbations are small, this gives the dominant contribution to the parallel diffusion coefficient, <a href="#eq-parallel-diffusion-coef" class="quarto-xref">Equation&nbsp;<span>27.17</span></a>.</p>
<p>For perpendicular transport, however, there is another important contribution due to the fact that the field line is not perfectly homogeneous. Instead, the large-scale magnetic field evaluated for a particle along a field line changes direction with distance along this field line. Under certain conditions, this movement can be shown to be diffusive, see below. If the movement of the particle due to this effect is included in the computation of the mean-square displacements (or equivalently through the Taylor-Green-Kubo approach), this gives the so-called <em>field-line random walk (FLRW)</em> contribution to perpendicular transport. The contribution without this is oftentimes called the <em>microscopic contribution</em>.</p>
<p>For slab turbulence, the microscopic diffusion coefficient vanishes (the transport is in fact sub-diffusive), hence FLRW gives the only contribution. For other turbulence geometries, FLRW can also contribute, but might not be dominating.</p>
<p>Let’s again assume the regular background field <span class="math inline">\(\langle \mathbf{B} \rangle = B_{z} \hat{z}\)</span> to be dominating over the perturbations <span class="math inline">\(\delta\mathbf{B}\)</span>. The equation determining the field line <span class="math inline">\(\{ x(z), y(z) \}\)</span> is <span class="math display">\[
\frac{\mathrm{d}x}{\mathrm{d}z} = \frac{\delta B_{x}}{B_{z}} \, ,\frac{\mathrm{d}y}{\mathrm{d}z} = \frac{\delta B_{y}}{B_{z}}
\]</span> This can formally be integrated to obtain the mean square displacement in the perpendicular directions, e.g. <span id="eq-mean-sqr-displacement-perp"><span class="math display">\[
\langle (\Delta x)^{2} \rangle \! = \! \frac{1}{B_{z}^{2}} \int _{0}^{z} \!\! \! \mathrm {d} z' \!\! \int _{0}^{z} \!\!\! \mathrm {d} z'' \langle \delta B_{x}(\mathbf{r}(z')) \delta B_{x}(\mathbf{r}(z'')) \rangle
\tag{27.35}\]</span></span></p>
<p>In slab turbulence, the integrand only depends on z and it is easy to show that the perpendicular mean-square displacement <span class="math inline">\(\langle (\Delta r_{\perp})^{2} \rangle\)</span> is ballistic at small z and diffusive for large z, e.g. <span class="math display">\[
\langle (\Delta x)^{2} \rangle = \left \{ \textstyle\begin{array}{l@{\quad } l} z^{2} \left ( \delta B_{x} / B_{z} \right )^{2} &amp; \text{for } z \to 0 \, , \\ 2 \kappa _{\text{FLRW}} |z| &amp; \text{for } z \to \infty \, , \end{array}\displaystyle \right .
\]</span> with the FLRW diffusion coefficient <span class="math display">\[
\kappa _{\text{FLRW}} = \frac{2 \pi ^{2}}{B_{z}^{2}} g^{\text{slab}}(0)
\]</span></p>
<p>In other turbulence geometries, the integrand in <a href="#eq-mean-sqr-displacement-perp" class="quarto-xref">Equation&nbsp;<span>27.35</span></a> also depends on x and y, such that an explicit solution is not possible without further assumptions.</p>
<p>If particles are assumed to diffuse along field lines, <span class="math inline">\(\langle (\Delta z)^{2} \rangle \propto \Delta t\)</span>, FLRW leads to subdiffusive perpendicular transport, <span class="math inline">\(\langle (\Delta r_{\perp})^{2} \rangle \propto \sqrt{\Delta t}\)</span>, a phenomenon known as <em>compound (sub)diffusion</em> (Jokipii 1966). Compound subdiffusion has been applied to a variety of environments like laboratory plasmas, the heliosphere, near-source transport as well as shock acceleration.</p>
</section>
<section id="short-comings-of-qlt" class="level3" data-number="27.1.6">
<h3 data-number="27.1.6" class="anchored" data-anchor-id="short-comings-of-qlt"><span class="header-section-number">27.1.6</span> Short-comings of QLT</h3>
<p>Despite its popularity, QLT exhibits a number of issues. The most well-known pathology of magnetostatic QLT is its inability to scatter particles through <span class="math inline">\(90^\circ\)</span>. While present in a number of turbulence geometries, it is easiest illustrated in slab turbulence where the dependence of the pitch-angle diffusion coefficient <span class="math inline">\(D_{\mu\mu}\)</span> on the spectrum <span class="math inline">\(g^{\text{slab}}(k)\)</span> becomes very simple. In fact, inspecting <a href="#eq-diffusion-coef-slab-turbulence" class="quarto-xref">Equation&nbsp;<span>27.34</span></a> we see that <span class="math inline">\(D_{\mu\mu}\to 0\)</span> for <span class="math inline">\(\mu\to 0\)</span>.</p>
<p>The root cause for the <span class="math inline">\(90^\circ\)</span> problem is the narrow resonance condition in magnetostatic QLT, <span class="math inline">\(k_{\parallel } \mu \, r_{\text{L}} = \pm 1\)</span> (<a href="#eq-slab-turbulence-resonance" class="quarto-xref">Equation&nbsp;<span>27.33</span></a>). Particles at finite <span class="math inline">\(\mu\)</span> are in resonance with waves of finite parallel wavenumber, <span class="math inline">\(k_{\parallel} = \pm 1 / (\mu r_{\text{L}})\)</span>. For <span class="math inline">\(\mu\to 0\)</span>, however, the resonant parallel wavenumber grows without bounds. With the turbulence spectra being falling power laws, however, there is only little energy at small scales and the pitch-angle scattering rate vanishes. In practice, there is of course no energy at all at scales below the dissipation scale.</p>
</section>
</section>
<section id="test-particle-simulation" class="level2" data-number="27.2">
<h2 data-number="27.2" class="anchored" data-anchor-id="test-particle-simulation"><span class="header-section-number">27.2</span> Test Particle Simulation</h2>
<p>In the absence of a widely accepted extension of quasi-linear theory, wave-particle interactions must also be studied in numerical simulations where the equations of motion are directly solved in a realisation of the turbulent magnetic field. The applications of such test particle simulations of cosmic rays are manifold: testing transport theories, computing parameters like diffusion coefficients or making predictions for phenomena beyond standard diffusion theories, e.g.&nbsp;for cosmic ray small-scale anisotropies.</p>
<p>Ideally, one would test these non-linear theories beyond QLT by comparing their predictions with data from observations. While this approach is being followed by the heliospheric community, a difficulty remains in that the actual turbulence (if known) turns out to be much more complex than what is routinely assumed in analytical transport theories. Alternatively, transport theories can be tested by comparing their predictions with those from numerical experiments.</p>
<p>Test particle simulations compute the transport of high-energy charged particles through prescribed EM fields without taking into account the effect of the high-energy particles on the EM fields. To this end, a realisation of the turbulent magnetic field is generated and the equations of motion are solved for test particles, that is the contributions of the CR particles to the EM fields are ignored. Given the trajectories of a large enough number of test particles, one can numerically compute the Fokker-Planck coefficients.</p>
<p>In addition to testing transport theories by comparing the analytically computed diffusion coefficients to simulated ones, there are at least two more applications of test particle simulations:</p>
<ol type="1">
<li><p>For sources at distances closer or similar to the scattering mean free path, the diffusive transport theory is not necessarily applicable. An often-cited pathology of computing solutions to the diffusion equation is superluminal propagation speeds. Lately, there has been increased interest in the transition between the ballistic and diffusive phases of transport and test particle simulations allow exploring this transition for given turbulent EM fields.</p></li>
<li><p>Analytical transport theories usually make predictions only for the ensemble-averaged phase-space density and it is usually assumed that the observed phase-space densities are close to the ensemble average. This has now been called into question, in particular in view of the observation of small-scale anisotropies observed in the arrival directions of TeV-PeV CRs. Test particle simulations naturally simulate CR distributions for individual realisations of the turbulent fields and thus provide direct access to such stochasticity effects.</p></li>
</ol>
<p>It needs to point that if the density in the relativistic particles is high enough, the particles can generate their own waves and induce a modification of the turbulence. This is the scenario when test particles models are no longer valid to describe the physics.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bellan2008fundamentals" class="csl-entry" role="listitem">
Bellan, Paul M. 2008. <em>Fundamentals of Plasma Physics</em>. Cambridge University Press.
</div>
<div id="ref-jokipii1966cosmic" class="csl-entry" role="listitem">
Jokipii, Jo R. 1966. <span>“Cosmic-Ray Propagation. I. Charged Particles in a Random Magnetic Field.”</span> <em>Astrophysical Journal, Vol. 146, p. 480</em> 146: 480. <a href="https://doi.org/10.1086/148912">https://doi.org/10.1086/148912</a>.
</div>
<div id="ref-mertsch2020test" class="csl-entry" role="listitem">
Mertsch, Philipp. 2020. <span>“Test Particle Simulations of Cosmic Rays.”</span> <em>Astrophysics and Space Science</em> 365 (8): 135. <a href="https://doi.org/10.1007/s10509-020-03832-3">https://doi.org/10.1007/s10509-020-03832-3</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>In CGS units, the electric and magnetic fields have the same unit.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Strictly speaking, the correlation lengths and times are tensors because of the vector nature of the magnetic field in the two-point functions; here, however, we only require them for order of magnitude arguments, so we do not distinguish the different components.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>In particle transport, ballistic refers to the movement of particles with minimal influence from their environment. Imagine a particle traveling on a frictionless, straight path, almost like a bullet. That’s ballistic transport!<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../contents/gc.html" class="pagination-link" aria-label="Guiding Center">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Guiding Center</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../contents/boundary.html" class="pagination-link" aria-label="Boundary Conditions">
        <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Boundary Conditions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/henry2004y/KeyNotes/edit/master/contents/cr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>